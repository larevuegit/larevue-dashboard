‚Ä®<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - La Revue</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background-color: white;
            border-radius: 12px;
            max-width: 95%;
            max-height: 95%;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(-50px) scale(0.95); }
            to { transform: translateY(0) scale(1); }
        }
        
        .star-rating {
            display: flex;
            gap: 4px;
            align-items: center;
        }
        
        .star {
            cursor: pointer;
            font-size: 24px;
            color: #d1d5db;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .star.active {
            color: #fbbf24;
            text-shadow: 0 0 8px rgba(251, 191, 36, 0.3);
        }
        
        .star:hover {
            color: #fbbf24;
            transform: scale(1.1);
        }
        
        .star-rating:hover .star {
            color: #e5e7eb;
        }
        
        .star-rating:hover .star:hover,
        .star-rating:hover .star:hover ~ .star {
            color: #d1d5db;
        }
        
        .star-rating:hover .star:hover,
        .star-rating .star:hover ~ .star {
            color: #fbbf24;
        }
        
        .tab {
            cursor: pointer;
            padding: 12px 24px;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }
        
        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.6s ease;
        }
        
        .tab:hover::before {
            left: 100%;
        }
        
        .tab.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.05);
        }
        
        .tab:hover:not(.active) {
            background-color: rgba(59, 130, 246, 0.02);
            color: #3b82f6;
        }
        
        .tab-content {
            display: none;
            animation: tabFadeIn 0.3s ease-in-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes tabFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .geocoding-status {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .geocoding-success {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .geocoding-error {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .geocoding-loading {
            background-color: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #059669, #047857);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }
        
        .btn-purple:hover {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-input:hover {
            border-color: #9ca3af;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 6px;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        .data-table th {
            background: linear-gradient(135deg, #f9fafb, #f3f4f6);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #f3f4f6;
            color: #6b7280;
        }
        
        .data-table tr:hover {
            background-color: rgba(59, 130, 246, 0.02);
        }
        
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .badge-success {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .badge-warning {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .badge-danger {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .badge-info {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        
        .image-preview img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid #e5e7eb;
            transition: all 0.2s ease;
        }
        
        .image-preview img:hover {
            transform: scale(1.05);
            border-color: #3b82f6;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ef4444, #10b981);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 8px 0;
        }
        
        .stat-label {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.8;
        }
        
        .filter-section {
            background: white;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            align-items: end;
        }
        
        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .criteria-item {
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .action-buttons .btn {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 2000;
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .notification.info {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background-color: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: white;
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-radius: 6px;
            z-index: 100;
            border: 1px solid #e5e7eb;
        }
        
        .dropdown-content a {
            color: #374151;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background-color 0.2s;
        }
        
        .dropdown-content a:hover {
            background-color: #f3f4f6;
        }
        
        .dropdown:hover .dropdown-content {
            display: block;
        }
        
        .searchable-input {
            position: relative;
        }
        
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 50;
            display: none;
        }
        
        .search-suggestion {
            padding: 8px 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .search-suggestion:hover {
            background-color: #f3f4f6;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #3b82f6;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-xl">LR</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                            Dashboard Admin - La Revue
                        </h1>
                        <p class="text-sm text-gray-500">Gestion compl√®te des √©tablissements et contenus</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-right">
                        <div class="text-sm font-medium text-gray-900">Administrateur</div>
                        <div class="text-xs text-gray-500">Derni√®re connexion: aujourd'hui</div>
                    </div>
                    <div class="w-8 h-8 bg-gray-300 rounded-full"></div>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- Navigation Tabs -->
        <div class="mb-8">
            <div class="flex border-b border-gray-200 bg-white rounded-t-lg">
                <div class="tab active" onclick="switchTab('establishments')">
                    <span class="font-medium">üè® √âtablissements</span>
                </div>
                <div class="tab" onclick="switchTab('news')">
                    <span class="font-medium">üì∞ Actualit√©s</span>
                </div>
                <div class="tab" onclick="switchTab('reviews')">
                    <span class="font-medium">‚≠ê Mod√©ration des Avis</span>
                </div>
                <div class="tab" onclick="switchTab('stats')">
                    <span class="font-medium">üìä Statistiques</span>
                </div>
                <div class="tab" onclick="switchTab('settings')">
                    <span class="font-medium">‚öôÔ∏è Param√®tres</span>
                </div>
            </div>
        </div>

        <!-- Establishments Tab -->
        <div id="establishments" class="tab-content active">
            <div class="card p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Gestion des √âtablissements</h2>
                        <p class="text-gray-600 mt-1">G√©rez vos h√¥tels, restaurants et spas avec g√©ocodage automatique</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="openAddModal()" class="btn btn-primary">
                            ‚ûï Ajouter un √©tablissement
                        </button>
                        <button onclick="importJSON()" class="btn btn-success">
                            üì• Importer JSON
                        </button>
                        <button onclick="exportJSON()" class="btn btn-purple">
                            üì§ Exporter JSON
                        </button>
                        <button onclick="bulkActions()" class="btn btn-secondary">
                            üîß Actions group√©es
                        </button>
                    </div>
                </div>

                <!-- Advanced Filters -->
                <div class="filter-section">
                    <h3 class="text-lg font-semibold mb-4">Filtres et Recherche</h3>
                    <div class="filter-grid">
                        <div>
                            <label class="form-label">Type d'√©tablissement</label>
                            <select id="filterType" onchange="applyFilters()" class="form-input">
                                <option value="">Tous les types</option>
                                <option value="hotel">üè® H√¥tel</option>
                                <option value="restaurant">üçΩÔ∏è Restaurant</option>
                                <option value="spa">üßò Spa</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Ville</label>
                            <select id="filterCity" onchange="applyFilters()" class="form-input">
                                <option value="">Toutes les villes</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Note minimum</label>
                            <select id="filterRating" onchange="applyFilters()" class="form-input">
                                <option value="">Toutes les notes</option>
                                <option value="1">‚≠ê 1 √©toile et plus</option>
                                <option value="2">‚≠ê 2 √©toiles et plus</option>
                                <option value="3">‚≠ê 3 √©toiles et plus</option>
                                <option value="4">‚≠ê 4 √©toiles et plus</option>
                                <option value="5">‚≠ê 5 √©toiles</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Statut g√©ocodage</label>
                            <select id="filterGeocoding" onchange="applyFilters()" class="form-input">
                                <option value="">Tous les statuts</option>
                                <option value="success">‚úÖ G√©ocod√©</option>
                                <option value="error">‚ùå Erreur</option>
                                <option value="not_found">‚ùì Non trouv√©</option>
                                <option value="none">‚ö™ Non g√©ocod√©</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Recherche globale</label>
                            <div class="searchable-input">
                                <input type="text" id="searchQuery" placeholder="Nom, ville, adresse..." onkeyup="applyFilters()" class="form-input">
                                <div id="searchSuggestions" class="search-suggestions"></div>
                            </div>
                        </div>
                        <div class="flex items-end">
                            <button onclick="clearFilters()" class="btn btn-secondary">
                                üóëÔ∏è Effacer filtres
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Results Summary -->
                <div class="flex justify-between items-center mb-4">
                    <div class="text-sm text-gray-600">
                        <span id="resultsCount">0</span> √©tablissement(s) trouv√©(s)
                        <span id="totalCount" class="ml-2 text-gray-400"></span>
                    </div>
                    <div class="flex items-center gap-4">
                        <label class="form-label">Tri par:</label>
                        <select id="sortBy" onchange="applySorting()" class="form-input" style="width: auto;">
                            <option value="name_asc">Nom (A-Z)</option>
                            <option value="name_desc">Nom (Z-A)</option>
                            <option value="city_asc">Ville (A-Z)</option>
                            <option value="city_desc">Ville (Z-A)</option>
                            <option value="rating_desc">Note (Haute √† Basse)</option>
                            <option value="rating_asc">Note (Basse √† Haute)</option>
                            <option value="date_desc">Date (Plus r√©cent)</option>
                            <option value="date_asc">Date (Plus ancien)</option>
                        </select>
                    </div>
                </div>

                <!-- Establishments Table -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                                </th>
                                <th>Nom</th>
                                <th>Type</th>
                                <th>Ville</th>
                                <th>Adresse</th>
                                <th>Note La Revue</th>
                                <th>Note Utilisateurs</th>
                                <th>Note G√©n√©rale</th>
                                <th>G√©ocodage</th>
                                <th>Photos</th>
                                <th>Date cr√©ation</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="establishmentsTable">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="flex justify-between items-center mt-6">
                    <div class="text-sm text-gray-600">
                        Page <span id="currentPage">1</span> sur <span id="totalPages">1</span>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="previousPage()" id="prevButton" class="btn btn-secondary" disabled>
                            ‚¨ÖÔ∏è Pr√©c√©dent
                        </button>
                        <div id="pageNumbers" class="flex gap-1">
                            <!-- Page numbers will be inserted here -->
                        </div>
                        <button onclick="nextPage()" id="nextButton" class="btn btn-secondary">
                            Suivant ‚û°Ô∏è
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- News Tab -->
        <div id="news" class="tab-content">
            <div class="card p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Gestion des Actualit√©s</h2>
                        <p class="text-gray-600 mt-1">Cr√©ez et g√©rez les actualit√©s par type d'√©tablissement</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="openAddNewsModal()" class="btn btn-primary">
                            ‚ûï Nouvelle actualit√©
                        </button>
                        <button onclick="manageFeaturedNews()" class="btn btn-success">
                            ‚≠ê G√©rer les unes
                        </button>
                        <button onclick="scheduleNews()" class="btn btn-purple">
                            ‚è∞ Programmer
                        </button>
                    </div>
                </div>

                <!-- News Filters -->
                <div class="filter-section">
                    <h3 class="text-lg font-semibold mb-4">Filtres des Actualit√©s</h3>
                    <div class="filter-grid">
                        <div>
                            <label class="form-label">Type d'actualit√©</label>
                            <select id="filterNewsType" onchange="applyNewsFilters()" class="form-input">
                                <option value="">Tous les types</option>
                                <option value="hotel">üè® H√¥tel</option>
                                <option value="restaurant">üçΩÔ∏è Restaurant</option>
                                <option value="spa">üßò Spa</option>
                                <option value="general">üåü G√©n√©ral</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Statut</label>
                            <select id="filterNewsStatus" onchange="applyNewsFilters()" class="form-input">
                                <option value="">Tous les statuts</option>
                                <option value="published">‚úÖ Publi√©</option>
                                <option value="draft">üìù Brouillon</option>
                                <option value="scheduled">‚è∞ Programm√©</option>
                                <option value="archived">üóÑÔ∏è Archiv√©</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">√Ä la une</label>
                            <select id="filterNewsFeatured" onchange="applyNewsFilters()" class="form-input">
                                <option value="">Tous</option>
                                <option value="true">‚≠ê √Ä la une</option>
                                <option value="false">üì∞ Standard</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">P√©riode</label>
                            <select id="filterNewsPeriod" onchange="applyNewsFilters()" class="form-input">
                                <option value="">Toutes les dates</option>
                                <option value="today">Aujourd'hui</option>
                                <option value="week">Cette semaine</option>
                                <option value="month">Ce mois</option>
                                <option value="year">Cette ann√©e</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Recherche</label>
                            <input type="text" id="searchNewsQuery" placeholder="Titre, contenu..." onkeyup="applyNewsFilters()" class="form-input">
                        </div>
                    </div>
                </div>

                <!-- Featured News Section -->
                <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-lg p-4 mb-6">
                    <h3 class="text-lg font-semibold text-yellow-800 mb-3">üåü Actualit√©s √† la une par cat√©gorie</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white p-3 rounded-lg border">
                            <h4 class="font-medium text-blue-800">üè® H√¥tels</h4>
                            <div id="featuredHotelNews" class="text-sm text-gray-600 mt-1">Aucune actualit√© en une</div>
                        </div>
                        <div class="bg-white p-3 rounded-lg border">
                            <h4 class="font-medium text-green-800">üçΩÔ∏è Restaurants</h4>
                            <div id="featuredRestaurantNews" class="text-sm text-gray-600 mt-1">Aucune actualit√© en une</div>
                        </div>
                        <div class="bg-white p-3 rounded-lg border">
                            <h4 class="font-medium text-purple-800">üßò Spas</h4>
                            <div id="featuredSpaNews" class="text-sm text-gray-600 mt-1">Aucune actualit√© en une</div>
                        </div>
                    </div>
                </div>

                <!-- News Table -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAllNews" onchange="toggleSelectAllNews()">
                                </th>
                                <th>Titre</th>
                                <th>Type</th>
                                <th>Statut</th>
                                <th>√Ä la une</th>
                                <th>Auteur</th>
                                <th>Date cr√©ation</th>
                                <th>Date publication</th>
                                <th>Vues</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="newsTable">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>

                <!-- News Pagination -->
                <div class="flex justify-between items-center mt-6">
                    <div class="text-sm text-gray-600">
                        <span id="newsResultsCount">0</span> actualit√©(s) trouv√©e(s)
                    </div>
                    <div class="flex gap-2">
                        <button onclick="previousNewsPage()" id="prevNewsButton" class="btn btn-secondary" disabled>
                            ‚¨ÖÔ∏è Pr√©c√©dent
                        </button>
                        <div id="newsPageNumbers" class="flex gap-1">
                            <!-- Page numbers will be inserted here -->
                        </div>
                        <button onclick="nextNewsPage()" id="nextNewsButton" class="btn btn-secondary">
                            Suivant ‚û°Ô∏è
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reviews Tab -->
        <div id="reviews" class="tab-content">
            <div class="card p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Mod√©ration des Avis</h2>
                        <p class="text-gray-600 mt-1">G√©rez les avis clients avec photos et √©valuations d√©taill√©es</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="bulkApproveReviews()" class="btn btn-success">
                            ‚úÖ Approuver la s√©lection
                        </button>
                        <button onclick="bulkRejectReviews()" class="btn btn-danger">
                            ‚ùå Rejeter la s√©lection
                        </button>
                        <button onclick="exportReviews()" class="btn btn-purple">
                            üìä Exporter rapport
                        </button>
                    </div>
                </div>

                <!-- Reviews Statistics -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-yellow-800 font-medium">En attente</p>
                                <p class="text-2xl font-bold text-yellow-900" id="pendingReviewsCount">0</p>
                            </div>
                            <div class="text-yellow-500 text-3xl">‚è≥</div>
                        </div>
                    </div>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-800 font-medium">Approuv√©s</p>
                                <p class="text-2xl font-bold text-green-900" id="approvedReviewsCount">0</p>
                            </div>
                            <div class="text-green-500 text-3xl">‚úÖ</div>
                        </div>
                    </div>
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-red-800 font-medium">Rejet√©s</p>
                                <p class="text-2xl font-bold text-red-900" id="rejectedReviewsCount">0</p>
                            </div>
                            <div class="text-red-500 text-3xl">‚ùå</div>
                        </div>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-800 font-medium">Note moyenne</p>
                                <p class="text-2xl font-bold text-blue-900" id="averageRating">0.0</p>
                            </div>
                            <div class="text-blue-500 text-3xl">‚≠ê</div>
                        </div>
                    </div>
                </div>

                <!-- Reviews Filters -->
                <div class="filter-section">
                    <h3 class="text-lg font-semibold mb-4">Filtres de Mod√©ration</h3>
                    <div class="filter-grid">
                        <div>
                            <label class="form-label">Statut</label>
                            <select id="filterReviewStatus" onchange="applyReviewFilters()" class="form-input">
                                <option value="">Tous les avis</option>
                                <option value="pending">‚è≥ En attente</option>
                                <option value="approved">‚úÖ Approuv√©s</option>
                                <option value="rejected">‚ùå Rejet√©s</option>
                                <option value="flagged">üö© Signal√©s</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Type d'√©tablissement</label>
                            <select id="filterReviewType" onchange="applyReviewFilters()" class="form-input">
                                <option value="">Tous les types</option>
                                <option value="hotel">üè® H√¥tel</option>
                                <option value="restaurant">üçΩÔ∏è Restaurant</option>
                                <option value="spa">üßò Spa</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Note donn√©e</label>
                            <select id="filterReviewRating" onchange="applyReviewFilters()" class="form-input">
                                <option value="">Toutes les notes</option>
                                <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5 √©toiles</option>
                                <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê 4 √©toiles</option>
                                <option value="3">‚≠ê‚≠ê‚≠ê 3 √©toiles</option>
                                <option value="2">‚≠ê‚≠ê 2 √©toiles</option>
                                <option value="1">‚≠ê 1 √©toile</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Avec photos</label>
                            <select id="filterReviewPhotos" onchange="applyReviewFilters()" class="form-input">
                                <option value="">Tous</option>
                                <option value="true">üì∏ Avec photos</option>
                                <option value="false">Sans photos</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">P√©riode</label>
                            <select id="filterReviewPeriod" onchange="applyReviewFilters()" class="form-input">
                                <option value="">Toutes les dates</option>
                                <option value="today">Aujourd'hui</option>
                                <option value="week">Cette semaine</option>
                                <option value="month">Ce mois</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Recherche</label>
                            <input type="text" id="searchReviewQuery" placeholder="Utilisateur, commentaire..." onkeyup="applyReviewFilters()" class="form-input">
                        </div>
                    </div>
                </div>

                <!-- Reviews Table -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAllReviews" onchange="toggleSelectAllReviews()">
                                </th>
                                <th>√âtablissement</th>
                                <th>Utilisateur</th>
                                <th>Note globale</th>
                                <th>Commentaire</th>
                                <th>Photos</th>
                                <th>Crit√®res d√©taill√©s</th>
                                <th>Date</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="reviewsTable">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>

                <!-- Reviews Pagination -->
                <div class="flex justify-between items-center mt-6">
                    <div class="text-sm text-gray-600">
                        <span id="reviewsResultsCount">0</span> avis trouv√©(s)
                    </div>
                    <div class="flex gap-2">
                        <button onclick="previousReviewsPage()" id="prevReviewsButton" class="btn btn-secondary" disabled>
                            ‚¨ÖÔ∏è Pr√©c√©dent
                        </button>
                        <div id="reviewsPageNumbers" class="flex gap-1">
                            <!-- Page numbers will be inserted here -->
                        </div>
                        <button onclick="nextReviewsPage()" id="nextReviewsButton" class="btn btn-secondary">
                            Suivant ‚û°Ô∏è
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Tab -->
        <div id="stats" class="tab-content">
            <div class="card p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Statistiques et Analytics</h2>
                        <p class="text-gray-600 mt-1">Visualisez les performances et tendances de votre plateforme</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="refreshStats()" class="btn btn-primary">
                            üîÑ Actualiser
                        </button>
                        <button onclick="exportStatsReport()" class="btn btn-success">
                            üìä Rapport PDF
                        </button>
                        <select id="statsTimeframe" onchange="updateStatsTimeframe()" class="form-input" style="width: auto;">
                            <option value="week">Cette semaine</option>
                            <option value="month">Ce mois</option>
                            <option value="quarter">Ce trimestre</option>
                            <option value="year">Cette ann√©e</option>
                        </select>
                    </div>
                </div>

                <!-- Key Performance Indicators -->
                <div class="stats-grid mb-8">
                    <div class="stat-card">
                        <div class="stat-label text-blue-600">Total √âtablissements</div>
                        <div class="stat-number text-blue-700" id="totalEstablishments">0</div>
                        <div class="text-sm text-gray-500">
                            <span class="text-green-600" id="establishmentsGrowth">+0%</span> ce mois
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label text-green-600">Actualit√©s Publi√©es</div>
                        <div class="stat-number text-green-700" id="totalPublishedNews">0</div>
                        <div class="text-sm text-gray-500">
                            <span class="text-green-600" id="newsGrowth">+0%</span> ce mois
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label text-purple-600">Avis Mod√©r√©s</div>
                        <div class="stat-number text-purple-700" id="totalModeratedReviews">0</div>
                        <div class="text-sm text-gray-500">
                            <span class="text-purple-600" id="reviewsGrowth">+0%</span> ce mois
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label text-orange-600">Note Moyenne Globale</div>
                        <div class="stat-number text-orange-700" id="globalAverageRating">0.0</div>
                        <div class="text-sm text-gray-500">
                            <span class="text-orange-600" id="ratingTrend">+0.0</span> vs mois dernier
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Establishments by Type Chart -->
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">R√©partition par Type</h3>
                        <div id="establishmentsChart" style="height: 300px;">
                            <div class="flex items-center justify-center h-full">
                                <div class="text-center">
                                    <div class="loading mb-2"></div>
                                    <p class="text-gray-500">Chargement des donn√©es...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Activity Chart -->
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">Activit√© Mensuelle</h3>
                        <div id="activityChart" style="height: 300px;">
                            <div class="flex items-center justify-center h-full">
                                <div class="text-center">
                                    <div class="loading mb-2"></div>
                                    <p class="text-gray-500">Chargement des donn√©es...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Geographic Distribution -->
                <div class="card p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">R√©partition G√©ographique</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-medium mb-3">Top 10 des Villes</h4>
                            <div id="topCities" class="space-y-2">
                                <!-- Cities list will be inserted here -->
                            </div>
                        </div>
                        <div>
                            <h4 class="font-medium mb-3">Statut de G√©ocodage</h4>
                            <div id="geocodingStats" class="space-y-2">
                                <!-- Geocoding stats will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reviews Analytics -->
                <div class="card p-6">
                    <h3 class="text-lg font-semibold mb-4">Analyse des Avis</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <h4 class="font-medium mb-3">Distribution des Notes</h4>
                            <div id="ratingsDistribution" class="space-y-2">
                                <!-- Ratings distribution will be inserted here -->
                            </div>
                        </div>
                        <div>
                            <h4 class="font-medium mb-3">Temps de Mod√©ration Moyen</h4>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-blue-600" id="avgModerationTime">0h</div>
                                <p class="text-sm text-gray-500">Temps moyen de traitement</p>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-medium mb-3">Taux d'Approbation</h4>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-green-600" id="approvalRate">0%</div>
                                <p class="text-sm text-gray-500">Avis approuv√©s</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="card p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Param√®tres Syst√®me</h2>
                        <p class="text-gray-600 mt-1">Configurez les param√®tres de l'application</p>
                    </div>
                    <button onclick="saveSettings()" class="btn btn-primary">
                        üíæ Sauvegarder
                    </button>
                </div>

                <!-- Firebase Configuration -->
                <div class="card p-4 mb-6">
                    <h3 class="text-lg font-semibold mb-4">üî• Configuration Firebase</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Project ID</label>
                            <input type="text" id="firebaseProjectId" class="form-input" placeholder="your-project-id">
                        </div>
                        <div>
                            <label class="form-label">API Key</label>
                            <input type="text" id="firebaseApiKey" class="form-input" placeholder="your-api-key">
                        </div>
                        <div>
                            <label class="form-label">Auth Domain</label>
                            <input type="text" id="firebaseAuthDomain" class="form-input" placeholder="your-project.firebaseapp.com">
                        </div>
                        <div>
                            <label class="form-label">Storage Bucket</label>
                            <input type="text" id="firebaseStorageBucket" class="form-input" placeholder="your-project.appspot.com">
                        </div>
                    </div>
                    <button onclick="testFirebaseConnection()" class="btn btn-secondary mt-4">
                        üîç Tester la connexion
                    </button>
                </div>

                <!-- General Settings -->
                <div class="card p-4 mb-6">
                    <h3 class="text-lg font-semibold mb-4">‚öôÔ∏è Param√®tres G√©n√©raux</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="form-label">G√©ocodage automatique</label>
                                <p class="text-sm text-gray-500">Active le g√©ocodage automatique lors de l'ajout d'√©tablissements</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoGeocoding" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="form-label">Mod√©ration automatique</label>
                                <p class="text-sm text-gray-500">Approuve automatiquement les avis avec 4-5 √©toiles</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoModeration">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="form-label">Notifications email</label>
                                <p class="text-sm text-gray-500">Envoie des notifications pour nouveaux avis</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="emailNotifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Backup & Export -->
                <div class="card p-4 mb-6">
                    <h3 class="text-lg font-semibold mb-4">üíæ Sauvegarde et Export</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="createBackup()" class="btn btn-primary">
                            üíæ Cr√©er sauvegarde
                        </button>
                        <button onclick="importBackup()" class="btn btn-secondary">
                            üì• Importer sauvegarde
                        </button>
                        <button onclick="exportAllData()" class="btn btn-success">
                            üì§ Exporter tout
                        </button>
                    </div>
                    <div class="mt-4">
                        <label class="form-label">Sauvegardes automatiques</label>
                        <select id="autoBackupFrequency" class="form-input">
                            <option value="none">D√©sactiv√©es</option>
                            <option value="daily">Quotidiennes</option>
                            <option value="weekly">Hebdomadaires</option>
                            <option value="monthly">Mensuelles</option>
                        </select>
                    </div>
                </div>

                <!-- System Information -->
                <div class="card p-4">
                    <h3 class="text-lg font-semibold mb-4">‚ÑπÔ∏è Informations Syst√®me</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <strong>Version de l'application:</strong> La Revue Dashboard v2.1.0
                        </div>
                        <div>
                            <strong>Derni√®re mise √† jour:</strong> <span id="lastUpdate">-</span>
                        </div>
                        <div>
                            <strong>Base de donn√©es:</strong> Firebase Firestore
                        </div>
                        <div>
                            <strong>Stockage:</strong> Firebase Storage
                        </div>
                        <div>
                            <strong>G√©ocodage:</strong> OpenStreetMap Nominatim API
                        </div>
                        <div>
                            <strong>Statut syst√®me:</strong> <span class="text-green-600">‚úÖ Op√©rationnel</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS SECTION -->

    <!-- Add Establishment Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content p-6" style="width: 900px; max-height: 90vh;">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900">‚ûï Ajouter un √©tablissement</h3>
                <button onclick="closeModal('addModal')" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <form id="addForm" class="space-y-6">
                <!-- Basic Information -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-900 mb-4">üìã Informations de base</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Nom de l'√©tablissement *</label>
                            <input type="text" id="name" required class="form-input" placeholder="Ex: H√¥tel des Alpes">
                        </div>
                        <div>
                            <label class="form-label">Type d'√©tablissement *</label>
                            <select id="type" required class="form-input" onchange="updateCriteriaFields()">
                                <option value="">S√©lectionner un type</option>
                                <option value="hotel">üè® H√¥tel</option>
                                <option value="restaurant">üçΩÔ∏è Restaurant</option>
                                <option value="spa">üßò Spa</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Address Information -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-900 mb-4">üìç Adresse et localisation</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Adresse compl√®te *</label>
                            <input type="text" id="address" required class="form-input" placeholder="123 Rue de la Paix">
                            <p class="text-xs text-gray-500 mt-1">Le g√©ocodage sera effectu√© automatiquement</p>
                        </div>
                        <div>
                            <label class="form-label">Ville *</label>
                            <input type="text" id="city" required class="form-input" placeholder="Paris">
                        </div>
                        <div>
                            <label class="form-label">Code postal</label>
                            <input type="text" id="zipCode" class="form-input" placeholder="75001">
                        </div>
                        <div>
                            <label class="form-label">Pays</label>
                            <input type="text" id="country" class="form-input" value="France" placeholder="France">
                        </div>
                    </div>
                    <div id="geocodingResult" class="mt-3"></div>
                </div>

                <!-- Contact Information -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-900 mb-4">üìû Informations de contact</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">T√©l√©phone</label>
                            <input type="tel" id="phone" class="form-input" placeholder="+33 1 23 45 67 89">
                        </div>
                        <div>
                            <label class="form-label">Email</label>
                            <input type="email" id="email" class="form-input" placeholder="contact@etablissement.com">
                        </div>
                        <div class="col-span-2">
                            <label class="form-label">Site web</label>
                            <input type="url" id="website" class="form-input" placeholder="https://www.etablissement.com">
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-900 mb-4">üìù Description</h4>
                    <textarea id="description" rows="4" class="form-input" placeholder="D√©crivez l'√©tablissement, ses services, son ambiance..."></textarea>
                </div>

                <!-- Images -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-900 mb-4">üñºÔ∏è Images</h4>
                    <div class="space-y-4">
                        <div>
                            <label class="form-label">T√©l√©charger des fichiers</label>
                            <input type="file" id="imageFiles" multiple accept="image/*" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">Ou URLs d'images (une par ligne)</label>
                            <textarea id="imageUrls" rows="3" class="form-input" placeholder="https://example.com/image1.jpg
https://example.com/image2.jpg"></textarea>
                        </div>
                        <div id="imagePreview" class="image-preview"></div>
                    </div>
                </div>

                <!-- Ratings -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-900 mb-4">‚≠ê √âvaluations globales</h4>
                    <div class="grid grid-cols-3 gap-6">
                        <div class="text-center">
                            <label class="form-label">Note La Revue</label>
                            <div class="star-rating flex justify-center" data-rating="laRevueRating">
                                <span class="star" data-value="1">‚òÖ</span>
                                <span class="star" data-value="2">‚òÖ</span>
                                <span class="star" data-value="3">‚òÖ</span>
                                <span class="star" data-value="4">‚òÖ</span>
                                <span class="star" data-value="5">‚òÖ</span>
                            </div>
                            <input type="hidden" id="laRevueRating" value="0">
                            <p class="text-xs text-gray-500 mt-1">√âvaluation officielle</p>
                        </div>
                        <div class="text-center">
                            <label class="form-label">Note Utilisateurs</label>
                            <div class="star-rating flex justify-center" data-rating="userRating">
                                <span class="star" data-value="1">‚òÖ</span>
                                <span class="star" data-value="2">‚òÖ</span>
                                <span class="star" data-value="3">‚òÖ</span>
                                <span class="star" data-value="4">‚òÖ</span>
                                <span class="star" data-value="5">‚òÖ</span>
                            </div>
                            <input type="hidden" id="userRating" value="0">
                            <p class="text-xs text-gray-500 mt-1">Moyenne des avis clients</p>
                        </div>
                        <div class="text-center">
                            <label class="form-label">Note G√©n√©rale</label>
                            <div class="star-rating flex justify-center" data-rating="generalRating">
                                <span class="star" data-value="1">‚òÖ</span>
                                <span class="star" data-value="2">‚òÖ</span>
                                <span class="star" data-value="3">‚òÖ</span>
                                <span class="star" data-value="4">‚òÖ</span>
                                <span class="star" data-value="5">‚òÖ</span>
                            </div>
                            <input type="hidden" id="generalRating" value="0">
                            <p class="text-xs text-gray-500 mt-1">Note finale calcul√©e</p>
                        </div>
                    </div>
                </div>

                <!-- Detailed Criteria (Dynamic based on type) -->
                <div id="criteriaSection" class="bg-gray-50 p-4 rounded-lg">
                    <!-- Will be populated dynamically -->
                </div>

                <!-- Form Actions -->
                <div class="flex justify-end gap-3 pt-4 border-t">
                    <button type="button" onclick="closeModal('addModal')" class="btn btn-secondary">
                        ‚ùå Annuler
                    </button>
                    <button type="submit" class="btn btn-primary">
                        ‚úÖ Ajouter l'√©tablissement
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Establishment Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content p-6" style="width: 900px; max-height: 90vh;">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900">‚úèÔ∏è Modifier l'√©tablissement</h3>
                <button onclick="closeModal('editModal')" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <form id="editForm" class="space-y-6">
                <input type="hidden" id="editId">
                
                <!-- Basic Information -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-900 mb-4">üìã Informations de base</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Nom de l'√©tablissement *</label>
                            <input type="text" id="editName" required class="form-input">
                        </div>
                        <div>
                            <label class="form-label">Type d'√©tablissement *</label>
                            <select id="editType" required class="form-input" onchange="updateEditCriteriaFields()">
                                <option value="">S√©lectionner un type</option>
                                <option value="hotel">üè® H√¥tel</option>
                                <option value="restaurant">üçΩÔ∏è Restaurant</option>
                                <option value="spa">üßò Spa</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Address Information -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-900 mb-4">üìç Adresse et localisation</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Adresse compl√®te *</label>
                            <input type="text" id="editAddress" required class="form-input">
                        </div>
                        <div>
                            <label class="form-label">Ville *</label>
                            <input type="text" id="editCity" required class="form-input">
                        </div>
                        <div>
                            <label class="form-label">Code postal</label>
                            <input type="text" id="editZipCode" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">Pays</label>
                            <input type="text" id="editCountry" class="form-input">
                        </div>
                    </div>
                    <div class="mt-3">
                        <button type="button" onclick="reGeocodeEstablishment()" class="btn btn-secondary btn-sm">
                            üåç Reg√©ocoder l'adresse
                        </button>
                    </div>
                    <div id="editGeocodingResult" class="mt-3"></div>
                </div>

                <!-- Contact Information -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-900 mb-4">üìû Informations de contact</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">T√©l√©phone</label>
                            <input type="tel" id="editPhone" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">Email</label>
                            <input type="email" id="editEmail" class="form-input">
                        </div>
                        <div class="col-span-2">
                            <label class="form-label">Site web</label>
                            <input type="url" id="editWebsite" class="form-input">
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-900 mb-4">üìù Description</h4>
                    <textarea id="editDescription" rows="4" class="form-input"></textarea>
                </div>

                <!-- Images -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-900 mb-4">üñºÔ∏è Images</h4>
                    <div class="space-y-4">
                        <div>
                            <label class="form-label">Ajouter de nouvelles images</label>
                            <input type="file" id="editImageFiles" multiple accept="image/*" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">Ou URLs d'images</label>
                            <textarea id="editImageUrls" rows="2" class="form-input"></textarea>
                        </div>
                        <div id="editImagePreview" class="image-preview"></div>
                    </div>
                </div>

                <!-- Ratings -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-900 mb-4">‚≠ê √âvaluations globales</h4>
                    <div class="grid grid-cols-3 gap-6">
                        <div class="text-center">
                            <label class="form-label">Note La Revue</label>
                            <div class="star-rating flex justify-center" data-rating="editLaRevueRating">
                                <span class="star" data-value="1">‚òÖ</span>
                                <span class="star" data-value="2">‚òÖ</span>
                                <span class="star" data-value="3">‚òÖ</span>
                                <span class="star" data-value="4">‚òÖ</span>
                                <span class="star" data-value="5">‚òÖ</span>
                            </div>
                            <input type="hidden" id="editLaRevueRating" value="0">
                        </div>
                        <div class="text-center">
                            <label class="form-label">Note Utilisateurs</label>
                            <div class="star-rating flex justify-center" data-rating="editUserRating">
                                <span class="star" data-value="1">‚òÖ</span>
                                <span class="star" data-value="2">‚òÖ</span>
                                <span class="star" data-value="3">‚òÖ</span>
                                <span class="star" data-value="4">‚òÖ</span>
                                <span class="star" data-value="5">‚òÖ</span>
                            </div>
                            <input type="hidden" id="editUserRating" value="0">
                        </div>
                        <div class="text-center">
                            <label class="form-label">Note G√©n√©rale</label>
                            <div class="star-rating flex justify-center" data-rating="editGeneralRating">
                                <span class="star" data-value="1">‚òÖ</span>
                                <span class="star" data-value="2">‚òÖ</span>
                                <span class="star" data-value="3">‚òÖ</span>
                                <span class="star" data-value="4">‚òÖ</span>
                                <span class="star" data-value="5">‚òÖ</span>
                            </div>
                            <input type="hidden" id="editGeneralRating" value="0">
                        </div>
                    </div>
                </div>

                <!-- Detailed Criteria (Dynamic) -->
                <div id="editCriteriaSection" class="bg-gray-50 p-4 rounded-lg">
                    <!-- Will be populated dynamically -->
                </div>

                <!-- Form Actions -->
                <div class="flex justify-end gap-3 pt-4 border-t">
                    <button type="button" onclick="closeModal('editModal')" class="btn btn-secondary">
                        ‚ùå Annuler
                    </button>
                    <button type="submit" class="btn btn-primary">
                        ‚úÖ Sauvegarder les modifications
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add News Modal -->
    <div id="addNewsModal" class="modal">
        <div class="modal-content p-6" style="width: 700px;">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900">üì∞ Nouvelle actualit√©</h3>
                <button onclick="closeModal('addNewsModal')" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <form id="addNewsForm" class="space-y-6">
                <!-- Basic Information -->
                <div class="space-y-4">
                    <div>
                        <label class="form-label">Titre de l'actualit√© *</label>
                        <input type="text" id="newsTitle" required class="form-input" placeholder="Titre accrocheur de votre actualit√©">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Cat√©gorie *</label>
                            <select id="newsType" required class="form-input">
                                <option value="">S√©lectionner une cat√©gorie</option>
                                <option value="hotel">üè® H√¥tels</option>
                                <option value="restaurant">üçΩÔ∏è Restaurants</option>
                                <option value="spa">üßò Spas</option>
                                <option value="general">üåü G√©n√©ral</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Statut</label>
                            <select id="newsStatus" class="form-input">
                                <option value="draft">üìù Brouillon</option>
                                <option value="published">‚úÖ Publi√©</option>
                                <option value="scheduled">‚è∞ Programm√©</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- NOUVEAU CHAMP VILLE √Ä AJOUTER ICI -->
                <div>
                    <label class="form-label">Ville (optionnel)</label>
                    <input type="text" id="newsCity" class="form-input" placeholder="Ex: Paris, Lyon, Marseille...">
                    <p class="text-xs text-gray-500 mt-1">Ville li√©e √† cette actualit√© pour l'affichage sur l'app mobile</p>
                </div>

                <!-- Content -->
                <div>
                    <label class="form-label">Contenu de l'actualit√© *</label>
                    <textarea id="newsContent" required rows="6" class="form-input" placeholder="R√©digez le contenu de votre actualit√©..."></textarea>
                    <p class="text-xs text-gray-500 mt-1">Vous pouvez utiliser du HTML pour la mise en forme</p>
                </div>
                <!-- R√©sum√© -->
                <div>
    <label class="form-label">R√©sum√© de l'actualit√© *</label>
    <textarea id="editNewsSummary" required rows="3" class="form-input" placeholder="R√©sum√© court de l'article (2-3 lignes maximum)" maxlength="200"></textarea>
    <p class="text-xs text-gray-500 mt-1">R√©sum√© qui s'affichera dans l'application mobile (200 caract√®res max)</p>
</div>

                <!-- Lien de l'article -->
                <div>
                    <label class="form-label">Lien de l'article (optionnel)</label>
                    <input type="url" id="newsArticleLink" class="form-input" placeholder="https://example.com/article">
                    <p class="text-xs text-gray-500 mt-1">Lien vers l'article complet si h√©berg√© ailleurs</p>
                </div>


                <!-- Image -->
                <div class="space-y-4">
                    <div>
                        <label class="form-label">Image principale</label>
                        <input type="file" id="newsImageFile" accept="image/*" class="form-input">
                    </div>
                    <div>
                        <label class="form-label">Ou URL d'image</label>
                        <input type="url" id="newsImageUrl" class="form-input" placeholder="https://example.com/image.jpg">
                    </div>
                    <div id="newsImagePreview" class="mt-2"></div>
                </div>

                <!-- Publishing Options -->
                <div class="bg-gray-50 p-4 rounded-lg space-y-4">
                    <h4 class="font-semibold text-gray-900">üìÖ Options de publication</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" id="newsFeatured" class="mr-2">
                                <span class="form-label">‚≠ê Mettre √† la une</span>
                            </label>
                            <p class="text-xs text-gray-500 ml-6">Affiche l'actualit√© en priorit√©</p>
                        </div>
                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" id="newsNotifyUsers" class="mr-2">
                                <span class="form-label">üìß Notifier les utilisateurs</span>
                            </label>
                            <p class="text-xs text-gray-500 ml-6">Envoie une notification</p>
                        </div>
                    </div>
                    <div id="schedulingOptions" style="display: none;">
                        <label class="form-label">Date de publication programm√©e</label>
                        <input type="datetime-local" id="newsScheduledDate" class="form-input">
                    </div>
                </div>

                <!-- Tags -->
                <div>
                    <label class="form-label">Tags (optionnel)</label>
                    <input type="text" id="newsTags" class="form-input" placeholder="actualit√©, h√¥tel, restaurant (s√©par√©s par des virgules)">
                </div>

                <!-- Form Actions -->
                <div class="flex justify-end gap-3 pt-4 border-t">
                    <button type="button" onclick="closeModal('addNewsModal')" class="btn btn-secondary">
                        ‚ùå Annuler
                    </button>
                    <button type="submit" class="btn btn-primary">
                        üì∞ Publier l'actualit√©
                    </button>
                </div>
            </form>
        </div>
    </div>

     <!-- Edit News Modal -->
    <div id="editNewsModal" class="modal">
        <div class="modal-content p-6" style="width: 700px;">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900">‚úèÔ∏è Modifier l'actualit√©</h3>
                <button onclick="closeEditNewsModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <form id="editNewsForm" class="space-y-6">
                <input type="hidden" id="editNewsId">
                
                <!-- Basic Information -->
                <div class="space-y-4">
                    <div>
                        <label class="form-label">Titre de l'actualit√© *</label>
                        <input type="text" id="editNewsTitle" required class="form-input">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Cat√©gorie *</label>
                            <select id="editNewsType" required class="form-input">
                                <option value="">S√©lectionner une cat√©gorie</option>
                                <option value="hotel">üè® H√¥tels</option>
                                <option value="restaurant">üçΩÔ∏è Restaurants</option>
                                <option value="spa">üßò Spas</option>
                                <option value="general">üåü G√©n√©ral</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Statut</label>
                            <select id="editNewsStatus" class="form-input">
                                <option value="draft">üìù Brouillon</option>
                                <option value="published">‚úÖ Publi√©</option>
                                <option value="scheduled">‚è∞ Programm√©</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- NOUVEAU CHAMP VILLE √Ä AJOUTER ICI -->
                <div>
                    <label class="form-label">Ville (optionnel)</label>
                    <input type="text" id="editNewsCity" class="form-input" placeholder="Ex: Paris, Lyon, Marseille...">
                    <p class="text-xs text-gray-500 mt-1">Ville li√©e √† cette actualit√©</p>
                </div>

                <!-- Content -->
                <div>
                    <label class="form-label">Contenu de l'actualit√© *</label>
                    <textarea id="editNewsContent" required rows="6" class="form-input"></textarea>
                </div>

                <!-- Lien de l'article -->
                <div>
                    <label class="form-label">Lien de l'article (optionnel)</label>
                    <input type="url" id="editNewsArticleLink" class="form-input" placeholder="https://example.com/article">
                    <p class="text-xs text-gray-500 mt-1">Lien vers l'article complet si h√©berg√© ailleurs</p>
                </div>

                <!-- Image -->
                <div>
                    <label class="form-label">URL d'image</label>
                    <input type="url" id="editNewsImageUrl" class="form-input" placeholder="https://example.com/image.jpg">
                </div>

                <!-- Publishing Options -->
                <div class="bg-gray-50 p-4 rounded-lg space-y-4">
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" id="editNewsFeature" class="mr-2">
                            <span class="form-label">‚≠ê Mettre √† la une</span>
                        </label>
                    </div>
                </div>

                <!-- Tags -->
                <div>
                    <label class="form-label">Tags</label>
                    <input type="text" id="editNewsTags" class="form-input" placeholder="actualit√©, h√¥tel, restaurant (s√©par√©s par des virgules)">
                </div>

                <!-- Form Actions -->
                <div class="flex justify-end gap-3 pt-4 border-t">
                    <button type="button" onclick="closeEditNewsModal()" class="btn btn-secondary">
                        ‚ùå Annuler
                    </button>
                    <button type="submit" class="btn btn-primary">
                        ‚úÖ Sauvegarder les modifications
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Review Detail Modal -->
    <div id="reviewDetailModal" class="modal">
        <div class="modal-content p-6" style="width: 800px;">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900">üëÅÔ∏è D√©tail de l'avis</h3>
                <button onclick="closeModal('reviewDetailModal')" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <div id="reviewDetailContent">
                <!-- Content will be populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" style="position: fixed; top: 20px; right: 20px; z-index: 2000;"></div>

    <!-- JavaScript Section -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjHNzW6i_d7HCZx_2K9Pv5JXIvafo1XNo",
            authDomain: "larevueapp-1f205.firebaseapp.com",
            projectId: "larevueapp-1f205",
            storageBucket: "larevueapp-1f205.firebasestorage.app",
            messagingSenderId: "248256257582",
            appId: "1:248256257582:web:a7b9281d0143e7ed35c9bf",
            measurementId: "G-KFKH0TQPHS"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Global Variables
        let establishments = [];
        let news = [];
        let reviews = [];
        let filteredEstablishments = [];
        let filteredNews = [];
        let filteredReviews = [];
        
        // Pagination
        let currentPage = 1;
        let itemsPerPage = 10;
        let currentNewsPage = 1;
        let currentReviewsPage = 1;

        // Criteria definitions by establishment type
        const criteriaByType = {
            hotel: ['Accueil', 'Confort', 'Propret√©', 'Emplacement', 'Services', 'Restauration', 'Rapport qualit√©-prix'],
            restaurant: ['Service', 'Qualit√© des plats', 'Cadre', 'Rapport qualit√©-prix', 'Originalit√©', 'Pr√©sentation', 'Ambiance'],
            spa: ['D√©tente', 'Qualit√© des soins', 'Accueil', 'Propret√©', 'Ambiance', '√âquipements', 'Personnel']
        };

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            showNotification('üîÑ Chargement des donn√©es...', 'info');
            
            try {
                await Promise.all([
                    loadEstablishments(),
                    loadNews(),
                    loadReviews()
                ]);
                
                setupEventListeners();
                updateStats();
                
                showNotification('‚úÖ Application charg√©e avec succ√®s!', 'success');
            } catch (error) {
                console.error('Erreur lors de l\'initialisation:', error);
                showNotification('‚ùå Erreur lors du chargement des donn√©es', 'error');
            }
        }

        function setupEventListeners() {
            // Star rating functionality
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('star')) {
                    handleStarRating(e);
                }
            });

            // Form submissions
            document.getElementById('addForm').addEventListener('submit', handleAddSubmit);
            document.getElementById('editForm').addEventListener('submit', handleEditSubmit);
            document.getElementById('addNewsForm').addEventListener('submit', handleAddNewsSubmit);
            document.getElementById('editNewsForm').addEventListener('submit', handleEditNewsSubmit);

            // Image preview functionality
            document.getElementById('imageFiles').addEventListener('change', handleImagePreview);
            document.getElementById('editImageFiles').addEventListener('change', handleEditImagePreview);
            document.getElementById('newsImageFile').addEventListener('change', handleNewsImagePreview);

            // Address change listeners for geocoding
            document.getElementById('address').addEventListener('blur', handleAddressChange);
            document.getElementById('city').addEventListener('blur', handleAddressChange);

            // News status change listener
            document.getElementById('newsStatus').addEventListener('change', function() {
                const schedulingOptions = document.getElementById('schedulingOptions');
                if (this.value === 'scheduled') {
                    schedulingOptions.style.display = 'block';
                } else {
                    schedulingOptions.style.display = 'none';
                }
            });
        }

        // Geocoding Functions
        async function geocodeAddress(address, city, country = 'France') {
            try {
                showNotification('üåç G√©ocodage en cours...', 'info');
                
                const query = encodeURIComponent(`${address}, ${city}, ${country}`);
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}&limit=1&addressdetails=1`);
                
                if (!response.ok) {
                    throw new Error('Erreur r√©seau lors du g√©ocodage');
                }
                
                const data = await response.json();
                
                if (data && data.length > 0) {
                    const result = {
                        latitude: parseFloat(data[0].lat),
                        longitude: parseFloat(data[0].lon),
                        formattedAddress: data[0].display_name,
                        status: 'success',
                        timestamp: new Date()
                    };
                    
                    showNotification('‚úÖ Adresse g√©ocod√©e avec succ√®s!', 'success');
                    return result;
                } else {
                    return { 
                        status: 'not_found',
                        error: 'Adresse non trouv√©e',
                        timestamp: new Date()
                    };
                }
            } catch (error) {
                console.error('Geocoding error:', error);
                showNotification('‚ùå Erreur lors du g√©ocodage', 'error');
                return {
                    status: 'error',
                    error: error.message,
                    timestamp: new Date()
                };
            }
        }

        function getGeocodingStatusDisplay(geocoding) {
            if (!geocoding) {
                return '<span class="geocoding-status geocoding-error">‚ö™ Non g√©ocod√©</span>';
            }
            
            switch (geocoding.status) {
                case 'success':
                    return `<span class="geocoding-status geocoding-success">‚úÖ G√©ocod√©</span>`;
                case 'not_found':
                    return '<span class="geocoding-status geocoding-error">‚ùì Adresse introuvable</span>';
                case 'error':
                    return '<span class="geocoding-status geocoding-error">‚ùå Erreur g√©ocodage</span>';
                default:
                    return '<span class="geocoding-status geocoding-error">‚ö™ Non g√©ocod√©</span>';
            }
        }

        async function handleAddressChange() {
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;
            
            if (address && city) {
                const resultDiv = document.getElementById('geocodingResult');
                resultDiv.innerHTML = '<div class="loading"></div> G√©ocodage en cours...';
                
                const geocoding = await geocodeAddress(address, city);
                displayGeocodingResult(geocoding, 'geocodingResult');
            }
        }

        function displayGeocodingResult(geocoding, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            if (geocoding.status === 'success') {
                container.innerHTML = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                        <div class="flex items-center gap-2">
                            <span class="text-green-600">‚úÖ</span>
                            <span class="font-medium text-green-800">Adresse g√©ocod√©e avec succ√®s</span>
                        </div>
                        <div class="text-sm text-green-700 mt-1">
                            üìç ${geocoding.latitude.toFixed(6)}, ${geocoding.longitude.toFixed(6)}
                        </div>
                        <div class="text-xs text-green-600 mt-1">
                            ${geocoding.formattedAddress}
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                        <div class="flex items-center gap-2">
                            <span class="text-red-600">‚ùå</span>
                            <span class="font-medium text-red-800">√âchec du g√©ocodage</span>
                        </div>
                        <div class="text-sm text-red-700 mt-1">
                            ${geocoding.error || 'Adresse non trouv√©e'}
                        </div>
                    </div>
                `;
            }
        }

        // Data Loading Functions
        async function loadEstablishments() {
            try {
                const snapshot = await db.collection('establishments').orderBy('name').get();
                establishments = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                filteredEstablishments = [...establishments];
                renderEstablishments();
                populateCityFilter();
                updatePagination();
            } catch (error) {
                console.error('Erreur lors du chargement des √©tablissements:', error);
                showNotification('‚ùå Erreur lors du chargement des √©tablissements', 'error');
            }
        }

        async function loadNews() {
            try {
                const snapshot = await db.collection('news').orderBy('createdAt', 'desc').get();
                news = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                filteredNews = [...news];
                renderNews();
                updateFeaturedNews();
            } catch (error) {
                console.error('Erreur lors du chargement des actualit√©s:', error);
                showNotification('‚ùå Erreur lors du chargement des actualit√©s', 'error');
            }
        }

        async function loadReviews() {
            try {
                const snapshot = await db.collection('reviews').orderBy('createdAt', 'desc').get();
                reviews = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                filteredReviews = [...reviews];
                renderReviews();
                updateReviewsStats();
            } catch (error) {
                console.error('Erreur lors du chargement des avis:', error);
                showNotification('‚ùå Erreur lors du chargement des avis', 'error');
            }
        }

        // Render Functions
        function renderEstablishments() {
            const tbody = document.getElementById('establishmentsTable');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageEstablishments = filteredEstablishments.slice(startIndex, endIndex);

            tbody.innerHTML = pageEstablishments.map(establishment => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3">
                        <input type="checkbox" class="establishment-checkbox" value="${establishment.id}">
                    </td>
                    <td class="px-4 py-3">
                        <div class="flex items-center gap-2">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-500 rounded-lg flex items-center justify-center text-white font-bold text-sm">
                                ${establishment.name.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div class="font-medium text-gray-900">${establishment.name}</div>
                                <div class="text-sm text-gray-500">#${establishment.id.substring(0, 8)}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-3">
                        <span class="badge badge-info">
                            ${getTypeIcon(establishment.type)} ${establishment.type}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <div class="font-medium">${establishment.city}</div>
                        <div class="text-sm text-gray-500">${establishment.zipCode || ''}</div>
                    </td>
                    <td class="px-4 py-3">
                        <div class="text-sm text-gray-600">${establishment.address}</div>
                    </td>
                    <td class="px-4 py-3 text-center">
                        ${renderStars(establishment.laRevueRating)}
                        <div class="text-xs text-gray-500">${establishment.laRevueRating}/5</div>
                    </td>
                    <td class="px-4 py-3 text-center">
                        ${renderStars(establishment.userRating)}
                        <div class="text-xs text-gray-500">${establishment.userRating}/5</div>
                    </td>
                    <td class="px-4 py-3 text-center">
                        ${renderStars(establishment.generalRating)}
                        <div class="text-xs text-gray-500">${establishment.generalRating}/5</div>
                    </td>
                    <td class="px-4 py-3">
                        ${getGeocodingStatusDisplay(establishment.geocoding)}
                    </td>
                    <td class="px-4 py-3 text-center">
                        <span class="text-blue-600">
                            ${establishment.images ? establishment.images.length : 0} üì∏
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <div class="text-sm text-gray-600">
                            ${formatDate(establishment.createdAt)}
                        </div>
                    </td>
                    <td class="px-4 py-3">
                        <div class="action-buttons">
                            <button onclick="editEstablishment('${establishment.id}')" class="btn btn-primary">
                                ‚úèÔ∏è Modifier
                            </button>
                            <button onclick="viewEstablishmentDetails('${establishment.id}')" class="btn btn-secondary">
                                üëÅÔ∏è Voir
                            </button>
                            <button onclick="deleteEstablishment('${establishment.id}')" class="btn btn-danger">
                                üóëÔ∏è Supprimer
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            updateResultsCount();
        }

        function renderNews() {
            const tbody = document.getElementById('newsTable');
            const startIndex = (currentNewsPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageNews = filteredNews.slice(startIndex, endIndex);

            tbody.innerHTML = pageNews.map(article => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3">
                        <input type="checkbox" class="news-checkbox" value="${article.id}">
                    </td>
                    <td class="px-4 py-3">
                        <div class="flex items-center gap-3">
                            ${article.imageUrl ? `<img src="${article.imageUrl}" class="w-12 h-12 object-cover rounded-lg">` : '<div class="w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center">üì∞</div>'}
                            <div>
                                <div class="font-medium text-gray-900">${article.title}</div>
                                <div class="text-sm text-gray-500">${truncateText(article.content, 60)}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-3">
                        <span class="badge badge-info">
                            ${getTypeIcon(article.type)} ${article.type}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <span class="badge ${getStatusBadgeClass(article.status)}">
                            ${getStatusIcon(article.status)} ${getStatusText(article.status)}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-center">
                        ${article.featured ? '<span class="text-yellow-500 text-xl">‚≠ê</span>' : ''}
                    </td>
                    <td class="px-4 py-3">
                        <div class="text-sm font-medium">${article.author || 'Administrateur'}</div>
                    </td>
                    <td class="px-4 py-3">
                        <div class="text-sm text-gray-600">
                            ${formatDate(article.createdAt)}
                        </div>
                    </td>
                    <td class="px-4 py-3">
                        <div class="text-sm text-gray-600">
                            ${article.publishedAt ? formatDate(article.publishedAt) : '-'}
                        </div>
                    </td>
                    <td class="px-4 py-3 text-center">
                        <span class="text-blue-600">${article.views || 0} üëÅÔ∏è</span>
                    </td>
                    <td class="px-4 py-3">
                        <div class="action-buttons">
                            <button onclick="editNews('${article.id}')" class="btn btn-primary">
                                ‚úèÔ∏è Modifier
                            </button>
                            <button onclick="toggleFeatured('${article.id}', ${!article.featured})" class="btn ${article.featured ? 'btn-warning' : 'btn-success'}">
                                ${article.featured ? '‚≠ê Retirer' : '‚≠ê Une'}
                            </button>
                            ${article.articleLink ? `<a href="${article.articleLink}" target="_blank" class="btn btn-secondary">üîó Lien</a>` : ''}
                            <button onclick="deleteNews('${article.id}')" class="btn btn-danger">
                                üóëÔ∏è Supprimer
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            updateNewsResultsCount();
        }

        function renderReviews() {
            const tbody = document.getElementById('reviewsTable');
            const startIndex = (currentReviewsPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageReviews = filteredReviews.slice(startIndex, endIndex);

            tbody.innerHTML = pageReviews.map(review => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3">
                        <input type="checkbox" class="review-checkbox" value="${review.id}">
                    </td>
                    <td class="px-4 py-3">
                        <div class="font-medium text-gray-900">${review.establishmentName || 'N/A'}</div>
                        <div class="text-sm text-gray-500">${review.establishmentType || ''}</div>
                    </td>
                    <td class="px-4 py-3">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-xs">
                                ${review.userName ? review.userName.charAt(0).toUpperCase() : 'U'}
                            </div>
                            <div>
                                <div class="font-medium text-sm">${review.userName}</div>
                                <div class="text-xs text-gray-500">${review.userEmail || ''}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-3 text-center">
                        ${renderStars(review.rating)}
                        <div class="text-xs text-gray-500">${review.rating}/5</div>
                    </td>
                    <td class="px-4 py-3">
                        <div class="max-w-xs">
                            <div class="text-sm text-gray-900">${truncateText(review.comment, 100)}</div>
                            ${review.comment.length > 100 ? '<button onclick="viewReview(\'' + review.id + '\')" class="text-blue-600 text-xs hover:underline">Lire plus...</button>' : ''}
                        </div>
                    </td>
                    <td class="px-4 py-3 text-center">
                        ${review.photos && review.photos.length > 0 ? 
                            `<span class="text-blue-600">${review.photos.length} üì∏</span>` : 
                            '<span class="text-gray-400">Aucune</span>'}
                    </td>
                    <td class="px-4 py-3">
                        <div class="text-sm">
                            ${review.criteria ? Object.keys(review.criteria).map(key => 
                                `<div class="flex justify-between"><span>${key}:</span><span>${renderStars(review.criteria[key])}</span></div>`
                            ).join('') : 'N/A'}
                        </div>
                    </td>
                    <td class="px-4 py-3">
                        <div class="text-sm text-gray-600">
                            ${formatDate(review.createdAt)}
                        </div>
                    </td>
                    <td class="px-4 py-3">
                        <span class="badge ${getReviewStatusBadgeClass(review.status)}">
                            ${getReviewStatusIcon(review.status)} ${getReviewStatusText(review.status)}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <div class="action-buttons">
                            ${review.status === 'pending' ? `
                                <button onclick="approveReview('${review.id}')" class="btn btn-success">
                                    ‚úÖ Approuver
                                </button>
                                <button onclick="rejectReview('${review.id}')" class="btn btn-danger">
                                    ‚ùå Rejeter
                                </button>
                            ` : ''}
                            <button onclick="viewReview('${review.id}')" class="btn btn-secondary">
                                üëÅÔ∏è D√©tails
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            updateReviewsResultsCount();
        }

        // Helper Functions
        function renderStars(rating) {
            const stars = [];
            for (let i = 1; i <= 5; i++) {
                stars.push(i <= rating ? '‚òÖ' : '‚òÜ');
            }
            return `<span class="text-yellow-500">${stars.join('')}</span>`;
        }

        function formatDate(timestamp) {
            if (!timestamp) return 'N/A';
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return date.toLocaleDateString('fr-FR', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function truncateText(text, maxLength) {
            if (!text) return '';
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        function getTypeIcon(type) {
            const icons = {
                hotel: 'üè®',
                restaurant: 'üçΩÔ∏è',
                spa: 'üßò',
                general: 'üåü'
            };
            return icons[type] || 'üìç';
        }

        function getStatusIcon(status) {
            const icons = {
                published: '‚úÖ',
                draft: 'üìù',
                scheduled: '‚è∞',
                archived: 'üóÑÔ∏è'
            };
            return icons[status] || '‚ùì';
        }

        function getStatusText(status) {
            const texts = {
                published: 'Publi√©',
                draft: 'Brouillon',
                scheduled: 'Programm√©',
                archived: 'Archiv√©'
            };
            return texts[status] || status;
        }

        function getStatusBadgeClass(status) {
            const classes = {
                published: 'badge-success',
                draft: 'badge-warning',
                scheduled: 'badge-info',
                archived: 'badge-secondary'
            };
            return classes[status] || 'badge-secondary';
        }

        function getReviewStatusIcon(status) {
            const icons = {
                pending: '‚è≥',
                approved: '‚úÖ',
                rejected: '‚ùå',
                flagged: 'üö©'
            };
            return icons[status] || '‚ùì';
        }

        function getReviewStatusText(status) {
            const texts = {
                pending: 'En attente',
                approved: 'Approuv√©',
                rejected: 'Rejet√©',
                flagged: 'Signal√©'
            };
            return texts[status] || status;
        }

        function getReviewStatusBadgeClass(status) {
            const classes = {
                pending: 'badge-warning',
                approved: 'badge-success',
                rejected: 'badge-danger',
                flagged: 'badge-danger'
            };
            return classes[status] || 'badge-secondary';
        }

        // Star Rating Handler
        function handleStarRating(e) {
            const rating = e.target.closest('.star-rating');
            const ratingName = rating.dataset.rating;
            const value = parseInt(e.target.dataset.value);
            
            rating.querySelectorAll('.star').forEach((star, index) => {
                star.classList.toggle('active', index < value);
            });
            
            const hiddenInput = document.getElementById(ratingName);
            if (hiddenInput) {
                hiddenInput.value = value;
            }
        }

        // Tab switching
        function switchTab(tabName) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked tab and corresponding content
            event.target.closest('.tab').classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Load tab-specific data if needed
            switch(tabName) {
                case 'stats':
                    updateStats();
                    break;
            }
        }

        // Filter Functions
        function applyFilters() {
            const typeFilter = document.getElementById('filterType').value;
            const cityFilter = document.getElementById('filterCity').value;
            const ratingFilter = document.getElementById('filterRating').value;
            const geocodingFilter = document.getElementById('filterGeocoding').value;
            const searchQuery = document.getElementById('searchQuery').value.toLowerCase();

            filteredEstablishments = establishments.filter(establishment => {
                const matchesType = !typeFilter || establishment.type === typeFilter;
                const matchesCity = !cityFilter || establishment.city === cityFilter;
                const matchesRating = !ratingFilter || establishment.generalRating >= parseInt(ratingFilter);
                const matchesGeocoding = !geocodingFilter || 
                    (geocodingFilter === 'none' && !establishment.geocoding) ||
                    (establishment.geocoding && establishment.geocoding.status === geocodingFilter);
                const matchesSearch = !searchQuery || 
                    establishment.name.toLowerCase().includes(searchQuery) ||
                    establishment.city.toLowerCase().includes(searchQuery) ||
                    establishment.address.toLowerCase().includes(searchQuery);

                return matchesType && matchesCity && matchesRating && matchesGeocoding && matchesSearch;
            });

            currentPage = 1;
            renderEstablishments();
            updatePagination();
        }

        function applyNewsFilters() {
            const typeFilter = document.getElementById('filterNewsType').value;
            const statusFilter = document.getElementById('filterNewsStatus').value;
            const featuredFilter = document.getElementById('filterNewsFeatured').value;
            const periodFilter = document.getElementById('filterNewsPeriod').value;
            const searchQuery = document.getElementById('searchNewsQuery').value.toLowerCase();

            filteredNews = news.filter(article => {
                const matchesType = !typeFilter || article.type === typeFilter;
                const matchesStatus = !statusFilter || article.status === statusFilter;
                const matchesFeatured = !featuredFilter || 
                    (featuredFilter === 'true' && article.featured) ||
                    (featuredFilter === 'false' && !article.featured);
                const matchesPeriod = !periodFilter || matchesTimePeriod(article.createdAt, periodFilter);
                const matchesSearch = !searchQuery || 
                    article.title.toLowerCase().includes(searchQuery) ||
                    article.content.toLowerCase().includes(searchQuery);

                return matchesType && matchesStatus && matchesFeatured && matchesPeriod && matchesSearch;
            });

            currentNewsPage = 1;
            renderNews();
        }

        function applyReviewFilters() {
            const statusFilter = document.getElementById('filterReviewStatus').value;
            const typeFilter = document.getElementById('filterReviewType').value;
            const ratingFilter = document.getElementById('filterReviewRating').value;
            const photosFilter = document.getElementById('filterReviewPhotos').value;
            const periodFilter = document.getElementById('filterReviewPeriod').value;
            const searchQuery = document.getElementById('searchReviewQuery').value.toLowerCase();

            filteredReviews = reviews.filter(review => {
                const matchesStatus = !statusFilter || review.status === statusFilter;
                const matchesType = !typeFilter || review.establishmentType === typeFilter;
                const matchesRating = !ratingFilter || review.rating === parseInt(ratingFilter);
                const matchesPhotos = !photosFilter || 
                    (photosFilter === 'true' && review.photos && review.photos.length > 0) ||
                    (photosFilter === 'false' && (!review.photos || review.photos.length === 0));
                const matchesPeriod = !periodFilter || matchesTimePeriod(review.createdAt, periodFilter);
                const matchesSearch = !searchQuery || 
                    review.userName.toLowerCase().includes(searchQuery) ||
                    review.comment.toLowerCase().includes(searchQuery) ||
                    (review.establishmentName && review.establishmentName.toLowerCase().includes(searchQuery));

                return matchesStatus && matchesType && matchesRating && matchesPhotos && matchesPeriod && matchesSearch;
            });

            currentReviewsPage = 1;
            renderReviews();
        }

        function matchesTimePeriod(timestamp, period) {
            if (!timestamp) return false;
            
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            const now = new Date();
            
            switch(period) {
                case 'today':
                    return date.toDateString() === now.toDateString();
                case 'week':
                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    return date >= weekAgo;
                case 'month':
                    const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    return date >= monthAgo;
                case 'year':
                    const yearAgo = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
                    return date >= yearAgo;
                default:
                    return true;
            }
        }

        function clearFilters() {
            document.getElementById('filterType').value = '';
            document.getElementById('filterCity').value = '';
            document.getElementById('filterRating').value = '';
            document.getElementById('filterGeocoding').value = '';
            document.getElementById('searchQuery').value = '';
            applyFilters();
        }

        function populateCityFilter() {
            const cities = [...new Set(establishments.map(est => est.city))].sort();
            const citySelect = document.getElementById('filterCity');
            
            citySelect.innerHTML = '<option value="">Toutes les villes</option>';
            cities.forEach(city => {
                citySelect.innerHTML += `<option value="${city}">${city}</option>`;
            });
        }

        // Pagination Functions
        function updatePagination() {
            const totalPages = Math.ceil(filteredEstablishments.length / itemsPerPage);
            document.getElementById('totalPages').textContent = totalPages;
            document.getElementById('currentPage').textContent = currentPage;
            
            document.getElementById('prevButton').disabled = currentPage === 1;
            document.getElementById('nextButton').disabled = currentPage === totalPages;
            
            updatePageNumbers();
        }

        function updatePageNumbers() {
            const totalPages = Math.ceil(filteredEstablishments.length / itemsPerPage);
            const pageNumbers = document.getElementById('pageNumbers');
            pageNumbers.innerHTML = '';
            
            const maxVisible = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
            let endPage = Math.min(totalPages, startPage + maxVisible - 1);
            
            if (endPage - startPage + 1 < maxVisible) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                button.className = `btn ${i === currentPage ? 'btn-primary' : 'btn-secondary'}`;
                button.onclick = () => goToPage(i);
                pageNumbers.appendChild(button);
            }
        }

        function goToPage(page) {
            currentPage = page;
            renderEstablishments();
            updatePagination();
        }

        function previousPage() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(filteredEstablishments.length / itemsPerPage);
            if (currentPage < totalPages) {
                goToPage(currentPage + 1);
            }
        }

        // Similar functions for news and reviews pagination
        function previousNewsPage() {
            if (currentNewsPage > 1) {
                currentNewsPage--;
                renderNews();
            }
        }

        function nextNewsPage() {
            const totalPages = Math.ceil(filteredNews.length / itemsPerPage);
            if (currentNewsPage < totalPages) {
                currentNewsPage++;
                renderNews();
            }
        }

        function previousReviewsPage() {
            if (currentReviewsPage > 1) {
                currentReviewsPage--;
                renderReviews();
            }
        }

        function nextReviewsPage() {
            const totalPages = Math.ceil(filteredReviews.length / itemsPerPage);
            if (currentReviewsPage < totalPages) {
                currentReviewsPage++;
                renderReviews();
            }
        }

        // Update result counts
        function updateResultsCount() {
            document.getElementById('resultsCount').textContent = filteredEstablishments.length;
            document.getElementById('totalCount').textContent = `(sur ${establishments.length} total)`;
        }

        function updateNewsResultsCount() {
            document.getElementById('newsResultsCount').textContent = filteredNews.length;
        }

        function updateReviewsResultsCount() {
            document.getElementById('reviewsResultsCount').textContent = filteredReviews.length;
        }

        // Modal Functions
        function openAddModal() {
            document.getElementById('addModal').classList.add('show');
            document.getElementById('addForm').reset();
            document.getElementById('imagePreview').innerHTML = '';
            document.getElementById('criteriaSection').innerHTML = '';
            document.getElementById('geocodingResult').innerHTML = '';
            resetStarRatings('addModal');
        }

        function openAddNewsModal() {
            document.getElementById('addNewsModal').classList.add('show');
            document.getElementById('addNewsForm').reset();
            document.getElementById('newsImagePreview').innerHTML = '';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function resetStarRatings(container) {
            const modal = document.getElementById(container) || document;
            modal.querySelectorAll('.star').forEach(star => {
                star.classList.remove('active');
            });
            modal.querySelectorAll('input[type="hidden"]').forEach(input => {
                if (input.id.includes('Rating')) {
                    input.value = '0';
                }
            });
        }

        // Criteria management
        function updateCriteriaFields() {
            const type = document.getElementById('type').value;
            const criteriaSection = document.getElementById('criteriaSection');
            
            if (type && criteriaByType[type]) {
                criteriaSection.innerHTML = `
                    <h4 class="font-semibold text-gray-900 mb-4">üìä √âvaluations d√©taill√©es par crit√®res</h4>
                    <div class="criteria-grid">
                        ${criteriaByType[type].map(criteria => `
                            <div class="criteria-item">
                                <label class="form-label">${criteria}</label>
                                <div class="star-rating flex justify-center" data-rating="criteria_${criteria.replace(/\s+/g, '_')}">
                                    <span class="star" data-value="1">‚òÖ</span>
                                    <span class="star" data-value="2">‚òÖ</span>
                                    <span class="star" data-value="3">‚òÖ</span>
                                    <span class="star" data-value="4">‚òÖ</span>
                                    <span class="star" data-value="5">‚òÖ</span>
                                </div>
                                <input type="hidden" id="criteria_${criteria.replace(/\s+/g, '_')}" value="0">
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                criteriaSection.innerHTML = '';
            }
        }

        function updateEditCriteriaFields() {
            const type = document.getElementById('editType').value;
            const criteriaSection = document.getElementById('editCriteriaSection');
            
            if (type && criteriaByType[type]) {
                criteriaSection.innerHTML = `
                    <h4 class="font-semibold text-gray-900 mb-4">üìä √âvaluations d√©taill√©es par crit√®res</h4>
                    <div class="criteria-grid">
                        ${criteriaByType[type].map(criteria => `
                            <div class="criteria-item">
                                <label class="form-label">${criteria}</label>
                                <div class="star-rating flex justify-center" data-rating="editCriteria_${criteria.replace(/\s+/g, '_')}">
                                    <span class="star" data-value="1">‚òÖ</span>
                                    <span class="star" data-value="2">‚òÖ</span>
                                    <span class="star" data-value="3">‚òÖ</span>
                                    <span class="star" data-value="4">‚òÖ</span>
                                    <span class="star" data-value="5">‚òÖ</span>
                                </div>
                                <input type="hidden" id="editCriteria_${criteria.replace(/\s+/g, '_')}" value="0">
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                criteriaSection.innerHTML = '';
            }
        }

        // Image handling
        function handleImagePreview(e) {
            const files = e.target.files;
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';

            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'w-20 h-20 object-cover rounded-lg border-2 border-gray-200 hover:border-blue-400 transition-colors';
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function handleEditImagePreview(e) {
            const files = e.target.files;
            const preview = document.getElementById('editImagePreview');
            
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'w-20 h-20 object-cover rounded-lg border-2 border-gray-200 hover:border-blue-400 transition-colors';
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function handleNewsImagePreview(e) {
            const file = e.target.files[0];
            const preview = document.getElementById('newsImagePreview');
            
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <img src="${e.target.result}" class="w-32 h-32 object-cover rounded-lg border-2 border-gray-200">
                    `;
                };
                reader.readAsDataURL(file);
            }
        }

        // Notification system
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, duration);
        }

        // Form submission handlers
        async function handleAddSubmit(e) {
            e.preventDefault();
            
            try {
                showNotification('üíæ Ajout en cours...', 'info');
                
                const formData = {
                    name: document.getElementById('name').value,
                    type: document.getElementById('type').value,
                    address: document.getElementById('address').value,
                    city: document.getElementById('city').value,
                    zipCode: document.getElementById('zipCode').value,
                    country: document.getElementById('country').value || 'France',
                    phone: document.getElementById('phone').value,
                    email: document.getElementById('email').value,
                    website: document.getElementById('website').value,
                    description: document.getElementById('description').value,
                    laRevueRating: parseInt(document.getElementById('laRevueRating').value),
                    userRating: parseInt(document.getElementById('userRating').value),
                    generalRating: parseInt(document.getElementById('generalRating').value),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Add criteria ratings
                if (criteriaByType[formData.type]) {
                    formData.criteria = {};
                    criteriaByType[formData.type].forEach(criteria => {
                        const fieldId = `criteria_${criteria.replace(/\s+/g, '_')}`;
                        const element = document.getElementById(fieldId);
                        if (element) {
                            formData.criteria[criteria] = parseInt(element.value) || 0;
                        }
                    });
                }

                // Handle geocoding if enabled
                const autoGeocoding = document.getElementById('autoGeocoding')?.checked !== false;
                if (autoGeocoding && formData.address && formData.city) {
                    const geocoding = await geocodeAddress(formData.address, formData.city, formData.country);
                    formData.geocoding = geocoding;
                }

                // Handle images
                const imageUrls = document.getElementById('imageUrls').value
                    .split('\n')
                    .map(url => url.trim())
                    .filter(url => url);
                    
                if (imageUrls.length > 0) {
                    formData.images = imageUrls;
                }

                // Save to Firestore
                await db.collection('establishments').add(formData);
                
                closeModal('addModal');
                await loadEstablishments();
                showNotification('‚úÖ √âtablissement ajout√© avec succ√®s!', 'success');
                
            } catch (error) {
                console.error('Erreur lors de l\'ajout:', error);
                showNotification('‚ùå Erreur lors de l\'ajout de l\'√©tablissement', 'error');
            }
        }

        async function handleEditSubmit(e) {
            e.preventDefault();
            
            try {
                showNotification('üíæ Modification en cours...', 'info');
                
                const id = document.getElementById('editId').value;
                const formData = {
                    name: document.getElementById('editName').value,
                    type: document.getElementById('editType').value,
                    address: document.getElementById('editAddress').value,
                    city: document.getElementById('editCity').value,
                    zipCode: document.getElementById('editZipCode').value,
                    country: document.getElementById('editCountry').value || 'France',
                    phone: document.getElementById('editPhone').value,
                    email: document.getElementById('editEmail').value,
                    website: document.getElementById('editWebsite').value,
                    description: document.getElementById('editDescription').value,
                    laRevueRating: parseInt(document.getElementById('editLaRevueRating').value),
                    userRating: parseInt(document.getElementById('editUserRating').value),
                    generalRating: parseInt(document.getElementById('editGeneralRating').value),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Add criteria ratings
                if (criteriaByType[formData.type]) {
                    formData.criteria = {};
                    criteriaByType[formData.type].forEach(criteria => {
                        const fieldId = `editCriteria_${criteria.replace(/\s+/g, '_')}`;
                        const element = document.getElementById(fieldId);
                        if (element) {
                            formData.criteria[criteria] = parseInt(element.value) || 0;
                        }
                    });
                }

                // Handle images
                const imageUrls = document.getElementById('editImageUrls').value
                    .split('\n')
                    .map(url => url.trim())
                    .filter(url => url);
                    
                if (imageUrls.length > 0) {
                    formData.images = imageUrls;
                }

                // Update in Firestore
                await db.collection('establishments').doc(id).update(formData);
                
                closeModal('editModal');
                await loadEstablishments();
                showNotification('‚úÖ √âtablissement modifi√© avec succ√®s!', 'success');
                
            } catch (error) {
                console.error('Erreur lors de la modification:', error);
                showNotification('‚ùå Erreur lors de la modification', 'error');
            }
        }

        async function handleAddNewsSubmit(e) {
            e.preventDefault();
            
            try {
                showNotification('üì∞ Publication en cours...', 'info');
                
                const formData = {
                    title: document.getElementById('newsTitle').value,
                    establishmentType: document.getElementById('newsType').value,
                    content: document.getElementById('newsContent').value,
                    summary: document.getElementById('newsSummary').value || 'R√©sum√© √† venir',
                    articleLink: document.getElementById('newsArticleLink').value,
                    city: document.getElementById('newsCity').value || '',
                    status: document.getElementById('newsStatus').value,
                    featured: document.getElementById('newsFeatured').checked,
                    notifyUsers: document.getElementById('newsNotifyUsers').checked,
                    author: 'Administrateur',
                    tags: document.getElementById('newsTags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                    views: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Handle scheduled publication
                const scheduledDate = document.getElementById('newsScheduledDate').value;
                if (formData.status === 'scheduled' && scheduledDate) {
                    formData.scheduledAt = new Date(scheduledDate);
                }

                // Handle publication date
                if (formData.status === 'published') {
                    formData.publishedAt = firebase.firestore.FieldValue.serverTimestamp();
                }

                // Handle image
                const imageUrl = document.getElementById('newsImageUrl').value;
                if (imageUrl) {
                    formData.imageUrl = imageUrl;
                }

                // Save to Firestore
                await db.collection('news').add(formData);
                
                closeModal('addNewsModal');
                await loadNews();
                updateFeaturedNews();
                showNotification('‚úÖ Actualit√© ajout√©e avec succ√®s!', 'success');
                
            } catch (error) {
                console.error('Erreur lors de l\'ajout de l\'actualit√©:', error);
                showNotification('‚ùå Erreur lors de l\'ajout de l\'actualit√©', 'error');
            }
        }

        // CRUD operations
        async function editEstablishment(id) {
            const establishment = establishments.find(est => est.id === id);
            if (!establishment) return;

            // Populate form fields
            document.getElementById('editId').value = id;
            document.getElementById('editName').value = establishment.name || '';
            document.getElementById('editType').value = establishment.type || '';
            document.getElementById('editAddress').value = establishment.address || '';
            document.getElementById('editCity').value = establishment.city || '';
            document.getElementById('editZipCode').value = establishment.zipCode || '';
            document.getElementById('editCountry').value = establishment.country || 'France';
            document.getElementById('editPhone').value = establishment.phone || '';
            document.getElementById('editEmail').value = establishment.email || '';
            document.getElementById('editWebsite').value = establishment.website || '';
            document.getElementById('editDescription').value = establishment.description || '';

            // Set ratings
            setStarRating('editLaRevueRating', establishment.laRevueRating || 0);
            setStarRating('editUserRating', establishment.userRating || 0);
            setStarRating('editGeneralRating', establishment.generalRating || 0);

            // Update criteria fields
            updateEditCriteriaFields();

            // Set criteria ratings
            if (establishment.criteria && criteriaByType[establishment.type]) {
                setTimeout(() => {
                    criteriaByType[establishment.type].forEach(criteria => {
                        const fieldId = `editCriteria_${criteria.replace(/\s+/g, '_')}`;
                        const rating = establishment.criteria[criteria] || 0;
                        setStarRating(fieldId, rating);
                    });
                }, 100);
            }

            // Handle images
            const editImagePreview = document.getElementById('editImagePreview');
            editImagePreview.innerHTML = '';
            if (establishment.images && establishment.images.length > 0) {
                establishment.images.forEach(imageUrl => {
                    const img = document.createElement('img');
                    img.src = imageUrl;
                    img.className = 'w-20 h-20 object-cover rounded-lg border-2 border-gray-200';
                    editImagePreview.appendChild(img);
                });
                document.getElementById('editImageUrls').value = establishment.images.join('\n');
            }

            // Display geocoding result
            if (establishment.geocoding) {
                displayGeocodingResult(establishment.geocoding, 'editGeocodingResult');
            }

            document.getElementById('editModal').classList.add('show');
        }

        function setStarRating(ratingId, value) {
            const hiddenInput = document.getElementById(ratingId);
            if (hiddenInput) {
                hiddenInput.value = value;
                const starRating = document.querySelector(`[data-rating="${ratingId}"]`);
                if (starRating) {
                    starRating.querySelectorAll('.star').forEach((star, index) => {
                        star.classList.toggle('active', index < value);
                    });
                }
            }
        }

        async function deleteEstablishment(id) {
            const establishment = establishments.find(est => est.id === id);
            if (!establishment) return;
            
            if (confirm(`√ätes-vous s√ªr de vouloir supprimer "${establishment.name}" ?\n\nCette action est irr√©versible.`)) {
                try {
                    showNotification('üóëÔ∏è Suppression en cours...', 'info');
                    
                    await db.collection('establishments').doc(id).delete();
                    await loadEstablishments();
                    
                    showNotification('‚úÖ √âtablissement supprim√© avec succ√®s!', 'success');
                } catch (error) {
                    console.error('Erreur lors de la suppression:', error);
                    showNotification('‚ùå Erreur lors de la suppression', 'error');
                }
            }
        }

        async function deleteNews(id) {
            const article = news.find(n => n.id === id);
            if (!article) return;
            
            if (confirm(`√ätes-vous s√ªr de vouloir supprimer l'actualit√© "${article.title}" ?\n\nCette action est irr√©versible.`)) {
                try {
                    showNotification('üóëÔ∏è Suppression en cours...', 'info');
                    
                    await db.collection('news').doc(id).delete();
                    await loadNews();
                    updateFeaturedNews();
                    
                    showNotification('‚úÖ Actualit√© supprim√©e avec succ√®s!', 'success');
                } catch (error) {
                    console.error('Erreur lors de la suppression:', error);
                    showNotification('‚ùå Erreur lors de la suppression', 'error');
                }
            }
        }

        async function toggleFeatured(id, featured) {
            try {
                const article = news.find(n => n.id === id);
                if (!article) return;
                
                // If setting as featured, check if there's already a featured article of this type
                if (featured) {
                    const existingFeatured = news.find(n => n.type === article.type && n.featured && n.id !== id);
                    if (existingFeatured) {
                        const confirmReplace = confirm(`Il y a d√©j√† une actualit√© "${article.type}" √† la une.\n\nVoulez-vous la remplacer ?`);
                        if (!confirmReplace) return;
                        
                        // Remove featured status from existing article
                        await db.collection('news').doc(existingFeatured.id).update({
                            featured: false,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                }
                
                await db.collection('news').doc(id).update({
                    featured: featured,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                await loadNews();
                updateFeaturedNews();
                
                showNotification(
                    featured ? '‚≠ê Actualit√© mise √† la une!' : 'üì∞ Actualit√© retir√©e de la une',
                    'success'
                );
                
            } catch (error) {
                console.error('Erreur lors de la modification:', error);
                showNotification('‚ùå Erreur lors de la modification', 'error');
            }
        }

        async function approveReview(id) {
            try {
                showNotification('‚úÖ Approbation en cours...', 'info');
                
                await db.collection('reviews').doc(id).update({
                    status: 'approved',
                    moderatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    moderatedBy: 'Administrateur'
                });
                
                await loadReviews();
                updateReviewsStats();
                
                showNotification('‚úÖ Avis approuv√© avec succ√®s!', 'success');
            } catch (error) {
                console.error('Erreur lors de l\'approbation:', error);
                showNotification('‚ùå Erreur lors de l\'approbation', 'error');
            }
        }

        async function rejectReview(id) {
            const reason = prompt('Raison du rejet (optionnel):');
            
            try {
                showNotification('‚ùå Rejet en cours...', 'info');
                
                const updateData = {
                    status: 'rejected',
                    moderatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    moderatedBy: 'Administrateur'
                };
                
                if (reason) {
                    updateData.rejectionReason = reason;
                }
                
                await db.collection('reviews').doc(id).update(updateData);
                
                await loadReviews();
                updateReviewsStats();
                
                showNotification('‚ùå Avis rejet√© avec succ√®s!', 'success');
            } catch (error) {
                console.error('Erreur lors du rejet:', error);
                showNotification('‚ùå Erreur lors du rejet', 'error');
            }
        }

        async function viewReview(id) {
            const review = reviews.find(r => r.id === id);
            if (!review) return;

            const content = `
                <div class="space-y-4">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">üë§ Informations utilisateur</h4>
                        <p><strong>Nom:</strong> ${review.userName}</p>
                        <p><strong>Email:</strong> ${review.userEmail || 'N/A'}</p>
                        <p><strong>Date:</strong> ${formatDate(review.createdAt)}</p>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">üè¢ √âtablissement</h4>
                        <p><strong>Nom:</strong> ${review.establishmentName}</p>
                        <p><strong>Type:</strong> ${review.establishmentType}</p>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">‚≠ê √âvaluation</h4>
                        <div class="mb-2">
                            <strong>Note globale:</strong> ${renderStars(review.rating)} (${review.rating}/5)
                        </div>
                        ${review.criteria ? `
                            <div>
                                <strong>Crit√®res d√©taill√©s:</strong>
                                <div class="mt-2 space-y-1">
                                    ${Object.entries(review.criteria).map(([key, value]) => 
                                        `<div class="flex justify-between">
                                            <span>${key}:</span>
                                            <span>${renderStars(value)} (${value}/5)</span>
                                        </div>`
                                    ).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">üí¨ Commentaire</h4>
                        <p class="text-gray-700">${review.comment}</p>
                    </div>
                    
                    ${review.photos && review.photos.length > 0 ? `
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">üì∏ Photos (${review.photos.length})</h4>
                            <div class="flex flex-wrap gap-2">
                                ${review.photos.map(photo => 
                                    `<img src="${photo}" class="w-24 h-24 object-cover rounded-lg border">`
                                ).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">üîç Statut de mod√©ration</h4>
                        <p><strong>Statut:</strong> <span class="badge ${getReviewStatusBadgeClass(review.status)}">${getReviewStatusText(review.status)}</span></p>
                        ${review.moderatedAt ? `<p><strong>Mod√©r√© le:</strong> ${formatDate(review.moderatedAt)}</p>` : ''}
                        ${review.moderatedBy ? `<p><strong>Mod√©r√© par:</strong> ${review.moderatedBy}</p>` : ''}
                        ${review.rejectionReason ? `<p><strong>Raison du rejet:</strong> ${review.rejectionReason}</p>` : ''}
                    </div>
                    
                    ${review.status === 'pending' ? `
                        <div class="flex justify-center gap-4 pt-4">
                            <button onclick="approveReview('${review.id}'); closeModal('reviewDetailModal')" class="btn btn-success">
                                ‚úÖ Approuver
                            </button>
                            <button onclick="rejectReview('${review.id}'); closeModal('reviewDetailModal')" class="btn btn-danger">
                                ‚ùå Rejeter
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;

            document.getElementById('reviewDetailContent').innerHTML = content;
            document.getElementById('reviewDetailModal').classList.add('show');
        }

        // Statistics and Updates
        function updateStats() {
            // Update establishment stats
            document.getElementById('totalEstablishments').textContent = establishments.length;
            document.getElementById('totalPublishedNews').textContent = news.filter(n => n.status === 'published').length;
            document.getElementById('totalModeratedReviews').textContent = reviews.filter(r => r.status !== 'pending').length;
            
            const avgRating = establishments.length > 0 ? 
                (establishments.reduce((sum, est) => sum + (est.generalRating || 0), 0) / establishments.length).toFixed(1) : '0.0';
            document.getElementById('globalAverageRating').textContent = avgRating;

            // Update growth indicators (simplified)
            document.getElementById('establishmentsGrowth').textContent = '+12%';
            document.getElementById('newsGrowth').textContent = '+8%';
            document.getElementById('reviewsGrowth').textContent = '+15%';
            document.getElementById('ratingTrend').textContent = '+0.3';

            updateTopCities();
            updateGeocodingStats();
            updateRatingsDistribution();
        }

        function updateReviewsStats() {
            const pendingCount = reviews.filter(r => r.status === 'pending').length;
            const approvedCount = reviews.filter(r => r.status === 'approved').length;
            const rejectedCount = reviews.filter(r => r.status === 'rejected').length;
            const totalReviews = reviews.length;
            
            document.getElementById('pendingReviewsCount').textContent = pendingCount;
            document.getElementById('approvedReviewsCount').textContent = approvedCount;
            document.getElementById('rejectedReviewsCount').textContent = rejectedCount;
            
            const avgRating = reviews.length > 0 ? 
                (reviews.reduce((sum, review) => sum + (review.rating || 0), 0) / reviews.length).toFixed(1) : '0.0';
            document.getElementById('averageRating').textContent = avgRating;
        }

        function updateFeaturedNews() {
            const featuredHotel = news.find(n => n.type === 'hotel' && n.featured);
            const featuredRestaurant = news.find(n => n.type === 'restaurant' && n.featured);
            const featuredSpa = news.find(n => n.type === 'spa' && n.featured);

            document.getElementById('featuredHotelNews').textContent = 
                featuredHotel ? featuredHotel.title : 'Aucune actualit√© en une';
            document.getElementById('featuredRestaurantNews').textContent = 
                featuredRestaurant ? featuredRestaurant.title : 'Aucune actualit√© en une';
            document.getElementById('featuredSpaNews').textContent = 
                featuredSpa ? featuredSpa.title : 'Aucune actualit√© en une';
        }

        function updateTopCities() {
            const cityCounts = {};
            establishments.forEach(est => {
                cityCounts[est.city] = (cityCounts[est.city] || 0) + 1;
            });

            const topCities = Object.entries(cityCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);

            const container = document.getElementById('topCities');
            container.innerHTML = topCities.map(([city, count]) => `
                <div class="flex justify-between items-center py-1">
                    <span class="text-gray-700">${city}</span>
                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">${count}</span>
                </div>
            `).join('');
        }

        function updateGeocodingStats() {
            const stats = {
                success: 0,
                error: 0,
                not_found: 0,
                none: 0
            };

            establishments.forEach(est => {
                if (!est.geocoding) {
                    stats.none++;
                } else {
                    stats[est.geocoding.status] = (stats[est.geocoding.status] || 0) + 1;
                }
            });

            const container = document.getElementById('geocodingStats');
            container.innerHTML = `
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-green-700">‚úÖ G√©ocod√©s</span>
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">${stats.success || 0}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-red-700">‚ùå Erreurs</span>
                        <span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm">${stats.error || 0}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-yellow-700">‚ùì Non trouv√©s</span>
                        <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm">${stats.not_found || 0}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-700">‚ö™ Non g√©ocod√©s</span>
                        <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded text-sm">${stats.none}</span>
                    </div>
                </div>
            `;
        }

        function updateRatingsDistribution() {
            const distribution = [1, 2, 3, 4, 5].map(rating => {
                const count = reviews.filter(r => r.rating === rating).length;
                return { rating, count };
            });

            const container = document.getElementById('ratingsDistribution');
            const maxCount = Math.max(...distribution.map(d => d.count));

            container.innerHTML = distribution.map(({ rating, count }) => {
                const percentage = maxCount > 0 ? (count / maxCount) * 100 : 0;
                return `
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-sm w-8">${rating}‚≠ê</span>
                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                            <div class="bg-yellow-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                        <span class="text-sm text-gray-600 w-8">${count}</span>
                    </div>
                `;
            }).join('');
        }

        // Import/Export Functions
        function importJSON() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = async function(e) {
                const file = e.target.files[0];
                if (!file) return;

                try {
                    showNotification('üì• Import en cours...', 'info');
                    
                    const text = await file.text();
                    const data = JSON.parse(text);
                    
                    if (!Array.isArray(data)) {
                        throw new Error('Le fichier doit contenir un tableau d\'objets');
                    }

                    const batch = db.batch();
                    let importCount = 0;

                    for (const item of data) {
                        // Validate required fields
                        if (!item.name || !item.type || !item.city) {
                            console.warn('Item ignor√© - champs requis manquants:', item);
                            continue;
                        }

                        // Add geocoding if address is provided
                        if (item.address && item.city) {
                            const geocoding = await geocodeAddress(item.address, item.city, item.country || 'France');
                            item.geocoding = geocoding;
                        }

                        const docRef = db.collection('establishments').doc();
                        batch.set(docRef, {
                            ...item,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        importCount++;
                    }

                    await batch.commit();
                    await loadEstablishments();
                    
                    showNotification(`‚úÖ ${importCount} √©tablissements import√©s avec succ√®s!`, 'success');
                    
                } catch (error) {
                    console.error('Erreur lors de l\'import:', error);
                    showNotification('‚ùå Erreur lors de l\'import: ' + error.message, 'error');
                }
            };
            input.click();
        }

        function exportJSON() {
            try {
                const dataToExport = establishments.map(est => {
                    const { id, createdAt, updatedAt, ...exportData } = est;
                    return exportData;
                });

                const blob = new Blob([JSON.stringify(dataToExport, null, 2)], {
                    type: 'application/json'
                });

                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `larevue_establishments_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showNotification('üì§ Export termin√© avec succ√®s!', 'success');
                
            } catch (error) {
                console.error('Erreur lors de l\'export:', error);
                showNotification('‚ùå Erreur lors de l\'export', 'error');
            }
        }

        // Bulk Actions
        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.establishment-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        function toggleSelectAllNews() {
            const selectAll = document.getElementById('selectAllNews');
            const checkboxes = document.querySelectorAll('.news-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        function toggleSelectAllReviews() {
            const selectAll = document.getElementById('selectAllReviews');
            const checkboxes = document.querySelectorAll('.review-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        async function bulkApproveReviews() {
            const selectedReviews = Array.from(document.querySelectorAll('.review-checkbox:checked'))
                .map(cb => cb.value);
            
            if (selectedReviews.length === 0) {
                showNotification('‚ùå Aucun avis s√©lectionn√©', 'error');
                return;
            }

            if (!confirm(`Approuver ${selectedReviews.length} avis s√©lectionn√©s ?`)) {
                return;
            }

            try {
                showNotification('‚úÖ Approbation en masse...', 'info');
                
                const batch = db.batch();
                selectedReviews.forEach(id => {
                    const docRef = db.collection('reviews').doc(id);
                    batch.update(docRef, {
                        status: 'approved',
                        moderatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        moderatedBy: 'Administrateur'
                    });
                });
                
                await batch.commit();
                await loadReviews();
                updateReviewsStats();
                
                showNotification(`‚úÖ ${selectedReviews.length} avis approuv√©s!`, 'success');
                
            } catch (error) {
                console.error('Erreur lors de l\'approbation en masse:', error);
                showNotification('‚ùå Erreur lors de l\'approbation en masse', 'error');
            }
        }

        async function bulkRejectReviews() {
            const selectedReviews = Array.from(document.querySelectorAll('.review-checkbox:checked'))
                .map(cb => cb.value);
            
            if (selectedReviews.length === 0) {
                showNotification('‚ùå Aucun avis s√©lectionn√©', 'error');
                return;
            }

            const reason = prompt('Raison du rejet (optionnel):');
            
            if (!confirm(`Rejeter ${selectedReviews.length} avis s√©lectionn√©s ?`)) {
                return;
            }

            try {
                showNotification('‚ùå Rejet en masse...', 'info');
                
                const batch = db.batch();
                selectedReviews.forEach(id => {
                    const updateData = {
                        status: 'rejected',
                        moderatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        moderatedBy: 'Administrateur'
                    };
                    
                    if (reason) {
                        updateData.rejectionReason = reason;
                    }
                    
                    const docRef = db.collection('reviews').doc(id);
                    batch.update(docRef, updateData);
                });
                
                await batch.commit();
                await loadReviews();
                updateReviewsStats();
                
                showNotification(`‚ùå ${selectedReviews.length} avis rejet√©s!`, 'success');
                
            } catch (error) {
                console.error('Erreur lors du rejet en masse:', error);
                showNotification('‚ùå Erreur lors du rejet en masse', 'error');
            }
        }

        // Settings Functions
        function saveSettings() {
            const settings = {
                autoGeocoding: document.getElementById('autoGeocoding')?.checked,
                autoModeration: document.getElementById('autoModeration')?.checked,
                emailNotifications: document.getElementById('emailNotifications')?.checked,
                autoBackupFrequency: document.getElementById('autoBackupFrequency')?.value,
                firebase: {
                    projectId: document.getElementById('firebaseProjectId')?.value,
                    apiKey: document.getElementById('firebaseApiKey')?.value,
                    authDomain: document.getElementById('firebaseAuthDomain')?.value,
                    storageBucket: document.getElementById('firebaseStorageBucket')?.value
                }
            };

            localStorage.setItem('larevue_settings', JSON.stringify(settings));
            showNotification('üíæ Param√®tres sauvegard√©s!', 'success');
        }

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('larevue_settings') || '{}');
            
            if (settings.autoGeocoding !== undefined) {
                document.getElementById('autoGeocoding').checked = settings.autoGeocoding;
            }
            if (settings.autoModeration !== undefined) {
                document.getElementById('autoModeration').checked = settings.autoModeration;
            }
            if (settings.emailNotifications !== undefined) {
                document.getElementById('emailNotifications').checked = settings.emailNotifications;
            }
            if (settings.autoBackupFrequency) {
                document.getElementById('autoBackupFrequency').value = settings.autoBackupFrequency;
            }
            
            // Load Firebase settings
            if (settings.firebase) {
                Object.entries(settings.firebase).forEach(([key, value]) => {
                    const element = document.getElementById(`firebase${key.charAt(0).toUpperCase() + key.slice(1)}`);
                    if (element && value) {
                        element.value = value;
                    }
                });
            }
        }

        function testFirebaseConnection() {
            // Test Firebase connection
            db.collection('establishments').limit(1).get()
                .then(() => {
                    showNotification('‚úÖ Connexion Firebase r√©ussie!', 'success');
                })
                .catch((error) => {
                    console.error('Erreur de connexion Firebase:', error);
                    showNotification('‚ùå Erreur de connexion Firebase', 'error');
                });
        }

        // Additional utility functions
        async function reGeocodeEstablishment() {
            const address = document.getElementById('editAddress').value;
            const city = document.getElementById('editCity').value;
            const country = document.getElementById('editCountry').value || 'France';
            
            if (!address || !city) {
                showNotification('‚ùå Adresse et ville requises pour le g√©ocodage', 'error');
                return;
            }

            const resultDiv = document.getElementById('editGeocodingResult');
            resultDiv.innerHTML = '<div class="loading"></div> Reg√©ocodage en cours...';
            
            const geocoding = await geocodeAddress(address, city, country);
            displayGeocodingResult(geocoding, 'editGeocodingResult');
        }

        function viewEstablishmentDetails(id) {
            const establishment = establishments.find(est => est.id === id);
            if (!establishment) return;
            
            alert(`D√©tails de ${establishment.name}\n\nType: ${establishment.type}\nVille: ${establishment.city}\nAdresse: ${establishment.address}\nT√©l√©phone: ${establishment.phone || 'N/A'}\nEmail: ${establishment.email || 'N/A'}\nSite web: ${establishment.website || 'N/A'}\n\nNotes:\n- La Revue: ${establishment.laRevueRating}/5\n- Utilisateurs: ${establishment.userRating}/5\n- G√©n√©rale: ${establishment.generalRating}/5`);
        }


        // News editing functions
        async function editNews(newsId) {
            try {
                const doc = await db.collection('news').doc(newsId).get();
                if (doc.exists) {
                    const newsData = doc.data();
                    
                    // Remplir le formulaire avec les donn√©es existantes
                    document.getElementById('editNewsId').value = newsId;
                    document.getElementById('editNewsTitle').value = newsData.title || '';
                    document.getElementById('editNewsContent').value = newsData.content || '';
                    document.getElementById('editNewsSummary').value = newsData.summary || '';
                    document.getElementById('editNewsCity').value = newsData.city || '';
                    document.getElementById('editNewsType').value = newsData.type || '';
                    document.getElementById('editNewsStatus').value = newsData.status || 'draft';
                    document.getElementById('editNewsFeature').checked = newsData.featured || false;
                    document.getElementById('editNewsImageUrl').value = newsData.imageUrl || '';
                    document.getElementById('editNewsArticleLink').value = newsData.articleLink || '';
                    document.getElementById('editNewsTags').value = newsData.tags ? newsData.tags.join(', ') : '';
            
                    
                    // Afficher le modal
                    document.getElementById('editNewsModal').classList.add('show');
                }
            } catch (error) {
                console.error('Erreur lors du chargement de l\'actualit√©:', error);
                alert('Erreur lors du chargement de l\'actualit√©');
            }
        }

        function closeEditNewsModal() {
            document.getElementById('editNewsModal').classList.remove('show');
            document.getElementById('editNewsForm').reset();
        }

        async function handleEditNewsSubmit(e) {
            e.preventDefault();
            
            try {
                showNotification('üíæ Modification en cours...', 'info');
                
                const newsId = document.getElementById('editNewsId').value;
                const formData = {
    title: document.getElementById('editNewsTitle').value,
    type: document.getElementById('editNewsType').value,
    content: document.getElementById('editNewsContent').value,
    summary: document.getElementById('editNewsSummary').value || 'R√©sum√© √† venir',    // ‚Üê NOUVELLE LIGNE
    articleLink: document.getElementById('editNewsArticleLink').value,
    city: document.getElementById('editNewsCity').value || '',
    status: document.getElementById('editNewsStatus').value,
    featured: document.getElementById('editNewsFeature').checked,
    tags: document.getElementById('editNewsTags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
};

                // Handle image
                const imageUrl = document.getElementById('editNewsImageUrl').value;
                if (imageUrl) {
                    formData.imageUrl = imageUrl;
                }

                // Handle publication date
                if (formData.status === 'published') {
                    formData.publishedAt = firebase.firestore.FieldValue.serverTimestamp();
                }

                // Update in Firestore
                await db.collection('news').doc(newsId).update(formData);
                
                closeEditNewsModal();
                await loadNews();
                updateFeaturedNews();
                showNotification('‚úÖ Actualit√© modifi√©e avec succ√®s!', 'success');
                
            } catch (error) {
                console.error('Erreur lors de la modification de l\'actualit√©:', error);
                showNotification('‚ùå Erreur lors de la modification de l\'actualit√©', 'error');
            }
        }





        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        // Initialize settings on load
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            
            // Set last update time
            document.getElementById('lastUpdate').textContent = new Date().toLocaleDateString('fr-FR');
        });

        // Auto-save functionality
        setInterval(() => {
            const settings = JSON.parse(localStorage.getItem('larevue_settings') || '{}');
            if (settings.autoBackupFrequency === 'daily') {
                // Implement auto-backup logic here
                console.log('Auto-backup would run here');
            }
        }, 24 * 60 * 60 * 1000); // Check daily

    </script>
</body>
</html>
